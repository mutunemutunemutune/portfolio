import{M as rt,g as wt,h as $e,c as nt,i as _t,d as qe,I as Dt,j as At,k as yt,l as Gt,m as Ot,n as it,o as It,p as st,D as Rt,q as ot}from"./three-BC_b6VJQ.js";import{d as Pe,t as Bt}from"./troika-worker-utils-DbVzmR1E.js";import{S as mt}from"./webgl-sdf-generator-B9WjZ7l-.js";import{b as Mt}from"./bidi-js-Dpu9EnKw.js";import{c as Et,v as Pt}from"./troika-three-utils-D8eIu-xZ.js";/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function Lt(){return typeof window>"u"&&(self.window=self),function(g){var o={parse:function(t){var e=o._bin,n=new Uint8Array(t);if(e.readASCII(n,0,4)=="ttcf"){var a=4;e.readUshort(n,a),a+=2,e.readUshort(n,a),a+=2;var r=e.readUint(n,a);a+=4;for(var i=[],s=0;s<r;s++){var l=e.readUint(n,a);a+=4,i.push(o._readFont(n,l))}return i}return[o._readFont(n,0)]},_readFont:function(t,e){var n=o._bin,a=e;n.readFixed(t,e),e+=4;var r=n.readUshort(t,e);e+=2,n.readUshort(t,e),e+=2,n.readUshort(t,e),e+=2,n.readUshort(t,e),e+=2;for(var i=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:t,_offset:a},l={},f=0;f<r;f++){var u=n.readASCII(t,e,4);e+=4,n.readUint(t,e),e+=4;var h=n.readUint(t,e);e+=4;var d=n.readUint(t,e);e+=4,l[u]={offset:h,length:d}}for(f=0;f<i.length;f++){var p=i[f];l[p]&&(s[p.trim()]=o[p.trim()].parse(t,l[p].offset,l[p].length,s))}return s},_tabOffset:function(t,e,n){for(var a=o._bin,r=a.readUshort(t,n+4),i=n+12,s=0;s<r;s++){var l=a.readASCII(t,i,4);i+=4,a.readUint(t,i),i+=4;var f=a.readUint(t,i);if(i+=4,a.readUint(t,i),i+=4,l==e)return f}return 0}};o._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,e){return o._bin.readShort(t,e)/16384},readInt:function(t,e){return o._bin._view(t).getInt32(e)},readInt8:function(t,e){return o._bin._view(t).getInt8(e)},readShort:function(t,e){return o._bin._view(t).getInt16(e)},readUshort:function(t,e){return o._bin._view(t).getUint16(e)},readUshorts:function(t,e,n){for(var a=[],r=0;r<n;r++)a.push(o._bin.readUshort(t,e+2*r));return a},readUint:function(t,e){return o._bin._view(t).getUint32(e)},readUint64:function(t,e){return 4294967296*o._bin.readUint(t,e)+o._bin.readUint(t,e+4)},readASCII:function(t,e,n){for(var a="",r=0;r<n;r++)a+=String.fromCharCode(t[e+r]);return a},readUnicode:function(t,e,n){for(var a="",r=0;r<n;r++){var i=t[e++]<<8|t[e++];a+=String.fromCharCode(i)}return a},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,e,n){var a=o._bin._tdec;return a&&e==0&&n==t.length?a.decode(t):o._bin.readASCII(t,e,n)},readBytes:function(t,e,n){for(var a=[],r=0;r<n;r++)a.push(t[e+r]);return a},readASCIIArray:function(t,e,n){for(var a=[],r=0;r<n;r++)a.push(String.fromCharCode(t[e+r]));return a},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},o._lctf={},o._lctf.parse=function(t,e,n,a,r){var i=o._bin,s={},l=e;i.readFixed(t,e),e+=4;var f=i.readUshort(t,e);e+=2;var u=i.readUshort(t,e);e+=2;var h=i.readUshort(t,e);return e+=2,s.scriptList=o._lctf.readScriptList(t,l+f),s.featureList=o._lctf.readFeatureList(t,l+u),s.lookupList=o._lctf.readLookupList(t,l+h,r),s},o._lctf.readLookupList=function(t,e,n){var a=o._bin,r=e,i=[],s=a.readUshort(t,e);e+=2;for(var l=0;l<s;l++){var f=a.readUshort(t,e);e+=2;var u=o._lctf.readLookupTable(t,r+f,n);i.push(u)}return i},o._lctf.readLookupTable=function(t,e,n){var a=o._bin,r=e,i={tabs:[]};i.ltype=a.readUshort(t,e),e+=2,i.flag=a.readUshort(t,e),e+=2;var s=a.readUshort(t,e);e+=2;for(var l=i.ltype,f=0;f<s;f++){var u=a.readUshort(t,e);e+=2;var h=n(t,l,r+u,i);i.tabs.push(h)}return i},o._lctf.numOfOnes=function(t){for(var e=0,n=0;n<32;n++)t>>>n&1&&e++;return e},o._lctf.readClassDef=function(t,e){var n=o._bin,a=[],r=n.readUshort(t,e);if(e+=2,r==1){var i=n.readUshort(t,e);e+=2;var s=n.readUshort(t,e);e+=2;for(var l=0;l<s;l++)a.push(i+l),a.push(i+l),a.push(n.readUshort(t,e)),e+=2}if(r==2){var f=n.readUshort(t,e);for(e+=2,l=0;l<f;l++)a.push(n.readUshort(t,e)),e+=2,a.push(n.readUshort(t,e)),e+=2,a.push(n.readUshort(t,e)),e+=2}return a},o._lctf.getInterval=function(t,e){for(var n=0;n<t.length;n+=3){var a=t[n],r=t[n+1];if(t[n+2],a<=e&&e<=r)return n}return-1},o._lctf.readCoverage=function(t,e){var n=o._bin,a={};a.fmt=n.readUshort(t,e),e+=2;var r=n.readUshort(t,e);return e+=2,a.fmt==1&&(a.tab=n.readUshorts(t,e,r)),a.fmt==2&&(a.tab=n.readUshorts(t,e,3*r)),a},o._lctf.coverageIndex=function(t,e){var n=t.tab;if(t.fmt==1)return n.indexOf(e);if(t.fmt==2){var a=o._lctf.getInterval(n,e);if(a!=-1)return n[a+2]+(e-n[a])}return-1},o._lctf.readFeatureList=function(t,e){var n=o._bin,a=e,r=[],i=n.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var l=n.readASCII(t,e,4);e+=4;var f=n.readUshort(t,e);e+=2;var u=o._lctf.readFeatureTable(t,a+f);u.tag=l.trim(),r.push(u)}return r},o._lctf.readFeatureTable=function(t,e){var n=o._bin,a=e,r={},i=n.readUshort(t,e);e+=2,i>0&&(r.featureParams=a+i);var s=n.readUshort(t,e);e+=2,r.tab=[];for(var l=0;l<s;l++)r.tab.push(n.readUshort(t,e+2*l));return r},o._lctf.readScriptList=function(t,e){var n=o._bin,a=e,r={},i=n.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var l=n.readASCII(t,e,4);e+=4;var f=n.readUshort(t,e);e+=2,r[l.trim()]=o._lctf.readScriptTable(t,a+f)}return r},o._lctf.readScriptTable=function(t,e){var n=o._bin,a=e,r={},i=n.readUshort(t,e);e+=2,i>0&&(r.default=o._lctf.readLangSysTable(t,a+i));var s=n.readUshort(t,e);e+=2;for(var l=0;l<s;l++){var f=n.readASCII(t,e,4);e+=4;var u=n.readUshort(t,e);e+=2,r[f.trim()]=o._lctf.readLangSysTable(t,a+u)}return r},o._lctf.readLangSysTable=function(t,e){var n=o._bin,a={};n.readUshort(t,e),e+=2,a.reqFeature=n.readUshort(t,e),e+=2;var r=n.readUshort(t,e);return e+=2,a.features=n.readUshorts(t,e,r),a},o.CFF={},o.CFF.parse=function(t,e,n){var a=o._bin;(t=new Uint8Array(t.buffer,e,n))[e=0],t[++e],t[++e],t[++e],e++;var r=[];e=o.CFF.readIndex(t,e,r);for(var i=[],s=0;s<r.length-1;s++)i.push(a.readASCII(t,e+r[s],r[s+1]-r[s]));e+=r[r.length-1];var l=[];e=o.CFF.readIndex(t,e,l);var f=[];for(s=0;s<l.length-1;s++)f.push(o.CFF.readDict(t,e+l[s],e+l[s+1]));e+=l[l.length-1];var u=f[0],h=[];e=o.CFF.readIndex(t,e,h);var d=[];for(s=0;s<h.length-1;s++)d.push(a.readASCII(t,e+h[s],h[s+1]-h[s]));if(e+=h[h.length-1],o.CFF.readSubrs(t,e,u),u.CharStrings){e=u.CharStrings,h=[],e=o.CFF.readIndex(t,e,h);var p=[];for(s=0;s<h.length-1;s++)p.push(a.readBytes(t,e+h[s],h[s+1]-h[s]));u.CharStrings=p}if(u.ROS){e=u.FDArray;var _=[];for(e=o.CFF.readIndex(t,e,_),u.FDArray=[],s=0;s<_.length-1;s++){var S=o.CFF.readDict(t,e+_[s],e+_[s+1]);o.CFF._readFDict(t,S,d),u.FDArray.push(S)}e+=_[_.length-1],e=u.FDSelect,u.FDSelect=[];var b=t[e];if(e++,b!=3)throw b;var v=a.readUshort(t,e);for(e+=2,s=0;s<v+1;s++)u.FDSelect.push(a.readUshort(t,e),t[e+2]),e+=3}return u.Encoding&&(u.Encoding=o.CFF.readEncoding(t,u.Encoding,u.CharStrings.length)),u.charset&&(u.charset=o.CFF.readCharset(t,u.charset,u.CharStrings.length)),o.CFF._readFDict(t,u,d),u},o.CFF._readFDict=function(t,e,n){var a;for(var r in e.Private&&(a=e.Private[1],e.Private=o.CFF.readDict(t,a,a+e.Private[0]),e.Private.Subrs&&o.CFF.readSubrs(t,a+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(r)!=-1&&(e[r]=n[e[r]-426+35])},o.CFF.readSubrs=function(t,e,n){var a=o._bin,r=[];e=o.CFF.readIndex(t,e,r);var i,s=r.length;i=s<1240?107:s<33900?1131:32768,n.Bias=i,n.Subrs=[];for(var l=0;l<r.length-1;l++)n.Subrs.push(a.readBytes(t,e+r[l],r[l+1]-r[l]))},o.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],o.CFF.glyphByUnicode=function(t,e){for(var n=0;n<t.charset.length;n++)if(t.charset[n]==e)return n;return-1},o.CFF.glyphBySE=function(t,e){return e<0||e>255?-1:o.CFF.glyphByUnicode(t,o.CFF.tableSE[e])},o.CFF.readEncoding=function(t,e,n){o._bin;var a=[".notdef"],r=t[e];if(e++,r!=0)throw"error: unknown encoding format: "+r;var i=t[e];e++;for(var s=0;s<i;s++)a.push(t[e+s]);return a},o.CFF.readCharset=function(t,e,n){var a=o._bin,r=[".notdef"],i=t[e];if(e++,i==0)for(var s=0;s<n;s++){var l=a.readUshort(t,e);e+=2,r.push(l)}else{if(i!=1&&i!=2)throw"error: format: "+i;for(;r.length<n;){l=a.readUshort(t,e),e+=2;var f=0;for(i==1?(f=t[e],e++):(f=a.readUshort(t,e),e+=2),s=0;s<=f;s++)r.push(l),l++}}return r},o.CFF.readIndex=function(t,e,n){var a=o._bin,r=a.readUshort(t,e)+1,i=t[e+=2];if(e++,i==1)for(var s=0;s<r;s++)n.push(t[e+s]);else if(i==2)for(s=0;s<r;s++)n.push(a.readUshort(t,e+2*s));else if(i==3)for(s=0;s<r;s++)n.push(16777215&a.readUint(t,e+3*s-1));else if(r!=1)throw"unsupported offset size: "+i+", count: "+r;return(e+=r*i)-1},o.CFF.getCharString=function(t,e,n){var a=o._bin,r=t[e],i=t[e+1];t[e+2],t[e+3],t[e+4];var s=1,l=null,f=null;r<=20&&(l=r,s=1),r==12&&(l=100*r+i,s=2),21<=r&&r<=27&&(l=r,s=1),r==28&&(f=a.readShort(t,e+1),s=3),29<=r&&r<=31&&(l=r,s=1),32<=r&&r<=246&&(f=r-139,s=1),247<=r&&r<=250&&(f=256*(r-247)+i+108,s=2),251<=r&&r<=254&&(f=256*-(r-251)-i-108,s=2),r==255&&(f=a.readInt(t,e+1)/65535,s=5),n.val=f??"o"+l,n.size=s},o.CFF.readCharString=function(t,e,n){for(var a=e+n,r=o._bin,i=[];e<a;){var s=t[e],l=t[e+1];t[e+2],t[e+3],t[e+4];var f=1,u=null,h=null;s<=20&&(u=s,f=1),s==12&&(u=100*s+l,f=2),s!=19&&s!=20||(u=s,f=2),21<=s&&s<=27&&(u=s,f=1),s==28&&(h=r.readShort(t,e+1),f=3),29<=s&&s<=31&&(u=s,f=1),32<=s&&s<=246&&(h=s-139,f=1),247<=s&&s<=250&&(h=256*(s-247)+l+108,f=2),251<=s&&s<=254&&(h=256*-(s-251)-l-108,f=2),s==255&&(h=r.readInt(t,e+1)/65535,f=5),i.push(h??"o"+u),e+=f}return i},o.CFF.readDict=function(t,e,n){for(var a=o._bin,r={},i=[];e<n;){var s=t[e],l=t[e+1];t[e+2],t[e+3],t[e+4];var f=1,u=null,h=null;if(s==28&&(h=a.readShort(t,e+1),f=3),s==29&&(h=a.readInt(t,e+1),f=5),32<=s&&s<=246&&(h=s-139,f=1),247<=s&&s<=250&&(h=256*(s-247)+l+108,f=2),251<=s&&s<=254&&(h=256*-(s-251)-l-108,f=2),s==255)throw h=a.readInt(t,e+1)/65535,f=5,"unknown number";if(s==30){var d=[];for(f=1;;){var p=t[e+f];f++;var _=p>>4,S=15&p;if(_!=15&&d.push(_),S!=15&&d.push(S),S==15)break}for(var b="",v=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],U=0;U<d.length;U++)b+=v[d[U]];h=parseFloat(b)}s<=21&&(u=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],f=1,s==12&&(u=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],f=2)),u!=null?(r[u]=i.length==1?i[0]:i,i=[]):i.push(h),e+=f}return r},o.cmap={},o.cmap.parse=function(t,e,n){t=new Uint8Array(t.buffer,e,n),e=0;var a=o._bin,r={};a.readUshort(t,e),e+=2;var i=a.readUshort(t,e);e+=2;var s=[];r.tables=[];for(var l=0;l<i;l++){var f=a.readUshort(t,e);e+=2;var u=a.readUshort(t,e);e+=2;var h=a.readUint(t,e);e+=4;var d="p"+f+"e"+u,p=s.indexOf(h);if(p==-1){var _;p=r.tables.length,s.push(h);var S=a.readUshort(t,h);S==0?_=o.cmap.parse0(t,h):S==4?_=o.cmap.parse4(t,h):S==6?_=o.cmap.parse6(t,h):S==12?_=o.cmap.parse12(t,h):console.debug("unknown format: "+S,f,u,h),r.tables.push(_)}if(r[d]!=null)throw"multiple tables for one platform+encoding";r[d]=p}return r},o.cmap.parse0=function(t,e){var n=o._bin,a={};a.format=n.readUshort(t,e),e+=2;var r=n.readUshort(t,e);e+=2,n.readUshort(t,e),e+=2,a.map=[];for(var i=0;i<r-6;i++)a.map.push(t[e+i]);return a},o.cmap.parse4=function(t,e){var n=o._bin,a=e,r={};r.format=n.readUshort(t,e),e+=2;var i=n.readUshort(t,e);e+=2,n.readUshort(t,e),e+=2;var s=n.readUshort(t,e);e+=2;var l=s/2;r.searchRange=n.readUshort(t,e),e+=2,r.entrySelector=n.readUshort(t,e),e+=2,r.rangeShift=n.readUshort(t,e),e+=2,r.endCount=n.readUshorts(t,e,l),e+=2*l,e+=2,r.startCount=n.readUshorts(t,e,l),e+=2*l,r.idDelta=[];for(var f=0;f<l;f++)r.idDelta.push(n.readShort(t,e)),e+=2;for(r.idRangeOffset=n.readUshorts(t,e,l),e+=2*l,r.glyphIdArray=[];e<a+i;)r.glyphIdArray.push(n.readUshort(t,e)),e+=2;return r},o.cmap.parse6=function(t,e){var n=o._bin,a={};a.format=n.readUshort(t,e),e+=2,n.readUshort(t,e),e+=2,n.readUshort(t,e),e+=2,a.firstCode=n.readUshort(t,e),e+=2;var r=n.readUshort(t,e);e+=2,a.glyphIdArray=[];for(var i=0;i<r;i++)a.glyphIdArray.push(n.readUshort(t,e)),e+=2;return a},o.cmap.parse12=function(t,e){var n=o._bin,a={};a.format=n.readUshort(t,e),e+=2,e+=2,n.readUint(t,e),e+=4,n.readUint(t,e),e+=4;var r=n.readUint(t,e);e+=4,a.groups=[];for(var i=0;i<r;i++){var s=e+12*i,l=n.readUint(t,s+0),f=n.readUint(t,s+4),u=n.readUint(t,s+8);a.groups.push([l,f,u])}return a},o.glyf={},o.glyf.parse=function(t,e,n,a){for(var r=[],i=0;i<a.maxp.numGlyphs;i++)r.push(null);return r},o.glyf._parseGlyf=function(t,e){var n=o._bin,a=t._data,r=o._tabOffset(a,"glyf",t._offset)+t.loca[e];if(t.loca[e]==t.loca[e+1])return null;var i={};if(i.noc=n.readShort(a,r),r+=2,i.xMin=n.readShort(a,r),r+=2,i.yMin=n.readShort(a,r),r+=2,i.xMax=n.readShort(a,r),r+=2,i.yMax=n.readShort(a,r),r+=2,i.xMin>=i.xMax||i.yMin>=i.yMax)return null;if(i.noc>0){i.endPts=[];for(var s=0;s<i.noc;s++)i.endPts.push(n.readUshort(a,r)),r+=2;var l=n.readUshort(a,r);if(r+=2,a.length-r<l)return null;i.instructions=n.readBytes(a,r,l),r+=l;var f=i.endPts[i.noc-1]+1;for(i.flags=[],s=0;s<f;s++){var u=a[r];if(r++,i.flags.push(u),(8&u)!=0){var h=a[r];r++;for(var d=0;d<h;d++)i.flags.push(u),s++}}for(i.xs=[],s=0;s<f;s++){var p=(2&i.flags[s])!=0,_=(16&i.flags[s])!=0;p?(i.xs.push(_?a[r]:-a[r]),r++):_?i.xs.push(0):(i.xs.push(n.readShort(a,r)),r+=2)}for(i.ys=[],s=0;s<f;s++)p=(4&i.flags[s])!=0,_=(32&i.flags[s])!=0,p?(i.ys.push(_?a[r]:-a[r]),r++):_?i.ys.push(0):(i.ys.push(n.readShort(a,r)),r+=2);var S=0,b=0;for(s=0;s<f;s++)S+=i.xs[s],b+=i.ys[s],i.xs[s]=S,i.ys[s]=b}else{var v;i.parts=[];do{v=n.readUshort(a,r),r+=2;var U={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(i.parts.push(U),U.glyphIndex=n.readUshort(a,r),r+=2,1&v){var w=n.readShort(a,r);r+=2;var k=n.readShort(a,r);r+=2}else w=n.readInt8(a,r),r++,k=n.readInt8(a,r),r++;2&v?(U.m.tx=w,U.m.ty=k):(U.p1=w,U.p2=k),8&v?(U.m.a=U.m.d=n.readF2dot14(a,r),r+=2):64&v?(U.m.a=n.readF2dot14(a,r),r+=2,U.m.d=n.readF2dot14(a,r),r+=2):128&v&&(U.m.a=n.readF2dot14(a,r),r+=2,U.m.b=n.readF2dot14(a,r),r+=2,U.m.c=n.readF2dot14(a,r),r+=2,U.m.d=n.readF2dot14(a,r),r+=2)}while(32&v);if(256&v){var T=n.readUshort(a,r);for(r+=2,i.instr=[],s=0;s<T;s++)i.instr.push(a[r]),r++}}return i},o.GDEF={},o.GDEF.parse=function(t,e,n,a){var r=e;e+=4;var i=o._bin.readUshort(t,e);return{glyphClassDef:i===0?null:o._lctf.readClassDef(t,r+i)}},o.GPOS={},o.GPOS.parse=function(t,e,n,a){return o._lctf.parse(t,e,n,a,o.GPOS.subt)},o.GPOS.subt=function(t,e,n,a){var r=o._bin,i=n,s={};if(s.fmt=r.readUshort(t,n),n+=2,e==1||e==2||e==3||e==7||e==8&&s.fmt<=2){var l=r.readUshort(t,n);n+=2,s.coverage=o._lctf.readCoverage(t,l+i)}if(e==1&&s.fmt==1){var f=r.readUshort(t,n);n+=2,f!=0&&(s.pos=o.GPOS.readValueRecord(t,n,f))}else if(e==2&&s.fmt>=1&&s.fmt<=2){f=r.readUshort(t,n),n+=2;var u=r.readUshort(t,n);n+=2;var h=o._lctf.numOfOnes(f),d=o._lctf.numOfOnes(u);if(s.fmt==1){s.pairsets=[];var p=r.readUshort(t,n);n+=2;for(var _=0;_<p;_++){var S=i+r.readUshort(t,n);n+=2;var b=r.readUshort(t,S);S+=2;for(var v=[],U=0;U<b;U++){var w=r.readUshort(t,S);S+=2,f!=0&&(c=o.GPOS.readValueRecord(t,S,f),S+=2*h),u!=0&&(F=o.GPOS.readValueRecord(t,S,u),S+=2*d),v.push({gid2:w,val1:c,val2:F})}s.pairsets.push(v)}}if(s.fmt==2){var k=r.readUshort(t,n);n+=2;var T=r.readUshort(t,n);n+=2;var G=r.readUshort(t,n);n+=2;var C=r.readUshort(t,n);for(n+=2,s.classDef1=o._lctf.readClassDef(t,i+k),s.classDef2=o._lctf.readClassDef(t,i+T),s.matrix=[],_=0;_<G;_++){var E=[];for(U=0;U<C;U++){var c=null,F=null;f!=0&&(c=o.GPOS.readValueRecord(t,n,f),n+=2*h),u!=0&&(F=o.GPOS.readValueRecord(t,n,u),n+=2*d),E.push({val1:c,val2:F})}s.matrix.push(E)}}}else if(e==4&&s.fmt==1)s.markCoverage=o._lctf.readCoverage(t,r.readUshort(t,n)+i),s.baseCoverage=o._lctf.readCoverage(t,r.readUshort(t,n+2)+i),s.markClassCount=r.readUshort(t,n+4),s.markArray=o.GPOS.readMarkArray(t,r.readUshort(t,n+6)+i),s.baseArray=o.GPOS.readBaseArray(t,r.readUshort(t,n+8)+i,s.markClassCount);else if(e==6&&s.fmt==1)s.mark1Coverage=o._lctf.readCoverage(t,r.readUshort(t,n)+i),s.mark2Coverage=o._lctf.readCoverage(t,r.readUshort(t,n+2)+i),s.markClassCount=r.readUshort(t,n+4),s.mark1Array=o.GPOS.readMarkArray(t,r.readUshort(t,n+6)+i),s.mark2Array=o.GPOS.readBaseArray(t,r.readUshort(t,n+8)+i,s.markClassCount);else{if(e==9&&s.fmt==1){var x=r.readUshort(t,n);n+=2;var R=r.readUint(t,n);if(n+=4,a.ltype==9)a.ltype=x;else if(a.ltype!=x)throw"invalid extension substitution";return o.GPOS.subt(t,a.ltype,i+R)}console.debug("unsupported GPOS table LookupType",e,"format",s.fmt)}return s},o.GPOS.readValueRecord=function(t,e,n){var a=o._bin,r=[];return r.push(1&n?a.readShort(t,e):0),e+=1&n?2:0,r.push(2&n?a.readShort(t,e):0),e+=2&n?2:0,r.push(4&n?a.readShort(t,e):0),e+=4&n?2:0,r.push(8&n?a.readShort(t,e):0),e+=8&n?2:0,r},o.GPOS.readBaseArray=function(t,e,n){var a=o._bin,r=[],i=e,s=a.readUshort(t,e);e+=2;for(var l=0;l<s;l++){for(var f=[],u=0;u<n;u++)f.push(o.GPOS.readAnchorRecord(t,i+a.readUshort(t,e))),e+=2;r.push(f)}return r},o.GPOS.readMarkArray=function(t,e){var n=o._bin,a=[],r=e,i=n.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var l=o.GPOS.readAnchorRecord(t,n.readUshort(t,e+2)+r);l.markClass=n.readUshort(t,e),a.push(l),e+=4}return a},o.GPOS.readAnchorRecord=function(t,e){var n=o._bin,a={};return a.fmt=n.readUshort(t,e),a.x=n.readShort(t,e+2),a.y=n.readShort(t,e+4),a},o.GSUB={},o.GSUB.parse=function(t,e,n,a){return o._lctf.parse(t,e,n,a,o.GSUB.subt)},o.GSUB.subt=function(t,e,n,a){var r=o._bin,i=n,s={};if(s.fmt=r.readUshort(t,n),n+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&s.fmt<=2||e==6&&s.fmt<=2){var l=r.readUshort(t,n);n+=2,s.coverage=o._lctf.readCoverage(t,i+l)}if(e==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=r.readShort(t,n),n+=2;else if(s.fmt==2){var f=r.readUshort(t,n);n+=2,s.newg=r.readUshorts(t,n,f),n+=2*s.newg.length}}else if(e==2&&s.fmt==1){f=r.readUshort(t,n),n+=2,s.seqs=[];for(var u=0;u<f;u++){var h=r.readUshort(t,n)+i;n+=2;var d=r.readUshort(t,h);s.seqs.push(r.readUshorts(t,h+2,d))}}else if(e==4)for(s.vals=[],f=r.readUshort(t,n),n+=2,u=0;u<f;u++){var p=r.readUshort(t,n);n+=2,s.vals.push(o.GSUB.readLigatureSet(t,i+p))}else if(e==5&&s.fmt==2){if(s.fmt==2){var _=r.readUshort(t,n);n+=2,s.cDef=o._lctf.readClassDef(t,i+_),s.scset=[];var S=r.readUshort(t,n);for(n+=2,u=0;u<S;u++){var b=r.readUshort(t,n);n+=2,s.scset.push(b==0?null:o.GSUB.readSubClassSet(t,i+b))}}}else if(e==6&&s.fmt==3){if(s.fmt==3){for(u=0;u<3;u++){f=r.readUshort(t,n),n+=2;for(var v=[],U=0;U<f;U++)v.push(o._lctf.readCoverage(t,i+r.readUshort(t,n+2*U)));n+=2*f,u==0&&(s.backCvg=v),u==1&&(s.inptCvg=v),u==2&&(s.ahedCvg=v)}f=r.readUshort(t,n),n+=2,s.lookupRec=o.GSUB.readSubstLookupRecords(t,n,f)}}else{if(e==7&&s.fmt==1){var w=r.readUshort(t,n);n+=2;var k=r.readUint(t,n);if(n+=4,a.ltype==9)a.ltype=w;else if(a.ltype!=w)throw"invalid extension substitution";return o.GSUB.subt(t,a.ltype,i+k)}console.debug("unsupported GSUB table LookupType",e,"format",s.fmt)}return s},o.GSUB.readSubClassSet=function(t,e){var n=o._bin.readUshort,a=e,r=[],i=n(t,e);e+=2;for(var s=0;s<i;s++){var l=n(t,e);e+=2,r.push(o.GSUB.readSubClassRule(t,a+l))}return r},o.GSUB.readSubClassRule=function(t,e){var n=o._bin.readUshort,a={},r=n(t,e),i=n(t,e+=2);e+=2,a.input=[];for(var s=0;s<r-1;s++)a.input.push(n(t,e)),e+=2;return a.substLookupRecords=o.GSUB.readSubstLookupRecords(t,e,i),a},o.GSUB.readSubstLookupRecords=function(t,e,n){for(var a=o._bin.readUshort,r=[],i=0;i<n;i++)r.push(a(t,e),a(t,e+2)),e+=4;return r},o.GSUB.readChainSubClassSet=function(t,e){var n=o._bin,a=e,r=[],i=n.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var l=n.readUshort(t,e);e+=2,r.push(o.GSUB.readChainSubClassRule(t,a+l))}return r},o.GSUB.readChainSubClassRule=function(t,e){for(var n=o._bin,a={},r=["backtrack","input","lookahead"],i=0;i<r.length;i++){var s=n.readUshort(t,e);e+=2,i==1&&s--,a[r[i]]=n.readUshorts(t,e,s),e+=2*a[r[i]].length}return s=n.readUshort(t,e),e+=2,a.subst=n.readUshorts(t,e,2*s),e+=2*a.subst.length,a},o.GSUB.readLigatureSet=function(t,e){var n=o._bin,a=e,r=[],i=n.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var l=n.readUshort(t,e);e+=2,r.push(o.GSUB.readLigature(t,a+l))}return r},o.GSUB.readLigature=function(t,e){var n=o._bin,a={chain:[]};a.nglyph=n.readUshort(t,e),e+=2;var r=n.readUshort(t,e);e+=2;for(var i=0;i<r-1;i++)a.chain.push(n.readUshort(t,e)),e+=2;return a},o.head={},o.head.parse=function(t,e,n){var a=o._bin,r={};return a.readFixed(t,e),e+=4,r.fontRevision=a.readFixed(t,e),e+=4,a.readUint(t,e),e+=4,a.readUint(t,e),e+=4,r.flags=a.readUshort(t,e),e+=2,r.unitsPerEm=a.readUshort(t,e),e+=2,r.created=a.readUint64(t,e),e+=8,r.modified=a.readUint64(t,e),e+=8,r.xMin=a.readShort(t,e),e+=2,r.yMin=a.readShort(t,e),e+=2,r.xMax=a.readShort(t,e),e+=2,r.yMax=a.readShort(t,e),e+=2,r.macStyle=a.readUshort(t,e),e+=2,r.lowestRecPPEM=a.readUshort(t,e),e+=2,r.fontDirectionHint=a.readShort(t,e),e+=2,r.indexToLocFormat=a.readShort(t,e),e+=2,r.glyphDataFormat=a.readShort(t,e),e+=2,r},o.hhea={},o.hhea.parse=function(t,e,n){var a=o._bin,r={};return a.readFixed(t,e),e+=4,r.ascender=a.readShort(t,e),e+=2,r.descender=a.readShort(t,e),e+=2,r.lineGap=a.readShort(t,e),e+=2,r.advanceWidthMax=a.readUshort(t,e),e+=2,r.minLeftSideBearing=a.readShort(t,e),e+=2,r.minRightSideBearing=a.readShort(t,e),e+=2,r.xMaxExtent=a.readShort(t,e),e+=2,r.caretSlopeRise=a.readShort(t,e),e+=2,r.caretSlopeRun=a.readShort(t,e),e+=2,r.caretOffset=a.readShort(t,e),e+=2,e+=8,r.metricDataFormat=a.readShort(t,e),e+=2,r.numberOfHMetrics=a.readUshort(t,e),e+=2,r},o.hmtx={},o.hmtx.parse=function(t,e,n,a){for(var r=o._bin,i={aWidth:[],lsBearing:[]},s=0,l=0,f=0;f<a.maxp.numGlyphs;f++)f<a.hhea.numberOfHMetrics&&(s=r.readUshort(t,e),e+=2,l=r.readShort(t,e),e+=2),i.aWidth.push(s),i.lsBearing.push(l);return i},o.kern={},o.kern.parse=function(t,e,n,a){var r=o._bin,i=r.readUshort(t,e);if(e+=2,i==1)return o.kern.parseV1(t,e-2,n,a);var s=r.readUshort(t,e);e+=2;for(var l={glyph1:[],rval:[]},f=0;f<s;f++){e+=2,n=r.readUshort(t,e),e+=2;var u=r.readUshort(t,e);e+=2;var h=u>>>8;if((h&=15)!=0)throw"unknown kern table format: "+h;e=o.kern.readFormat0(t,e,l)}return l},o.kern.parseV1=function(t,e,n,a){var r=o._bin;r.readFixed(t,e),e+=4;var i=r.readUint(t,e);e+=4;for(var s={glyph1:[],rval:[]},l=0;l<i;l++){r.readUint(t,e),e+=4;var f=r.readUshort(t,e);e+=2,r.readUshort(t,e),e+=2;var u=f>>>8;if((u&=15)!=0)throw"unknown kern table format: "+u;e=o.kern.readFormat0(t,e,s)}return s},o.kern.readFormat0=function(t,e,n){var a=o._bin,r=-1,i=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2;for(var s=0;s<i;s++){var l=a.readUshort(t,e);e+=2;var f=a.readUshort(t,e);e+=2;var u=a.readShort(t,e);e+=2,l!=r&&(n.glyph1.push(l),n.rval.push({glyph2:[],vals:[]}));var h=n.rval[n.rval.length-1];h.glyph2.push(f),h.vals.push(u),r=l}return e},o.loca={},o.loca.parse=function(t,e,n,a){var r=o._bin,i=[],s=a.head.indexToLocFormat,l=a.maxp.numGlyphs+1;if(s==0)for(var f=0;f<l;f++)i.push(r.readUshort(t,e+(f<<1))<<1);if(s==1)for(f=0;f<l;f++)i.push(r.readUint(t,e+(f<<2)));return i},o.maxp={},o.maxp.parse=function(t,e,n){var a=o._bin,r={},i=a.readUint(t,e);return e+=4,r.numGlyphs=a.readUshort(t,e),e+=2,i==65536&&(r.maxPoints=a.readUshort(t,e),e+=2,r.maxContours=a.readUshort(t,e),e+=2,r.maxCompositePoints=a.readUshort(t,e),e+=2,r.maxCompositeContours=a.readUshort(t,e),e+=2,r.maxZones=a.readUshort(t,e),e+=2,r.maxTwilightPoints=a.readUshort(t,e),e+=2,r.maxStorage=a.readUshort(t,e),e+=2,r.maxFunctionDefs=a.readUshort(t,e),e+=2,r.maxInstructionDefs=a.readUshort(t,e),e+=2,r.maxStackElements=a.readUshort(t,e),e+=2,r.maxSizeOfInstructions=a.readUshort(t,e),e+=2,r.maxComponentElements=a.readUshort(t,e),e+=2,r.maxComponentDepth=a.readUshort(t,e),e+=2),r},o.name={},o.name.parse=function(t,e,n){var a=o._bin,r={};a.readUshort(t,e),e+=2;var i=a.readUshort(t,e);e+=2,a.readUshort(t,e);for(var s,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],f=e+=2,u=0;u<i;u++){var h=a.readUshort(t,e);e+=2;var d=a.readUshort(t,e);e+=2;var p=a.readUshort(t,e);e+=2;var _=a.readUshort(t,e);e+=2;var S=a.readUshort(t,e);e+=2;var b=a.readUshort(t,e);e+=2;var v,U=l[_],w=f+12*i+b;if(h==0)v=a.readUnicode(t,w,S/2);else if(h==3&&d==0)v=a.readUnicode(t,w,S/2);else if(d==0)v=a.readASCII(t,w,S);else if(d==1)v=a.readUnicode(t,w,S/2);else if(d==3)v=a.readUnicode(t,w,S/2);else{if(h!=1)throw"unknown encoding "+d+", platformID: "+h;v=a.readASCII(t,w,S),console.debug("reading unknown MAC encoding "+d+" as ASCII")}var k="p"+h+","+p.toString(16);r[k]==null&&(r[k]={}),r[k][U!==void 0?U:_]=v,r[k]._lang=p}for(var T in r)if(r[T].postScriptName!=null&&r[T]._lang==1033)return r[T];for(var T in r)if(r[T].postScriptName!=null&&r[T]._lang==0)return r[T];for(var T in r)if(r[T].postScriptName!=null&&r[T]._lang==3084)return r[T];for(var T in r)if(r[T].postScriptName!=null)return r[T];for(var T in r){s=T;break}return console.debug("returning name table with languageID "+r[s]._lang),r[s]},o["OS/2"]={},o["OS/2"].parse=function(t,e,n){var a=o._bin.readUshort(t,e);e+=2;var r={};if(a==0)o["OS/2"].version0(t,e,r);else if(a==1)o["OS/2"].version1(t,e,r);else if(a==2||a==3||a==4)o["OS/2"].version2(t,e,r);else{if(a!=5)throw"unknown OS/2 table version: "+a;o["OS/2"].version5(t,e,r)}return r},o["OS/2"].version0=function(t,e,n){var a=o._bin;return n.xAvgCharWidth=a.readShort(t,e),e+=2,n.usWeightClass=a.readUshort(t,e),e+=2,n.usWidthClass=a.readUshort(t,e),e+=2,n.fsType=a.readUshort(t,e),e+=2,n.ySubscriptXSize=a.readShort(t,e),e+=2,n.ySubscriptYSize=a.readShort(t,e),e+=2,n.ySubscriptXOffset=a.readShort(t,e),e+=2,n.ySubscriptYOffset=a.readShort(t,e),e+=2,n.ySuperscriptXSize=a.readShort(t,e),e+=2,n.ySuperscriptYSize=a.readShort(t,e),e+=2,n.ySuperscriptXOffset=a.readShort(t,e),e+=2,n.ySuperscriptYOffset=a.readShort(t,e),e+=2,n.yStrikeoutSize=a.readShort(t,e),e+=2,n.yStrikeoutPosition=a.readShort(t,e),e+=2,n.sFamilyClass=a.readShort(t,e),e+=2,n.panose=a.readBytes(t,e,10),e+=10,n.ulUnicodeRange1=a.readUint(t,e),e+=4,n.ulUnicodeRange2=a.readUint(t,e),e+=4,n.ulUnicodeRange3=a.readUint(t,e),e+=4,n.ulUnicodeRange4=a.readUint(t,e),e+=4,n.achVendID=[a.readInt8(t,e),a.readInt8(t,e+1),a.readInt8(t,e+2),a.readInt8(t,e+3)],e+=4,n.fsSelection=a.readUshort(t,e),e+=2,n.usFirstCharIndex=a.readUshort(t,e),e+=2,n.usLastCharIndex=a.readUshort(t,e),e+=2,n.sTypoAscender=a.readShort(t,e),e+=2,n.sTypoDescender=a.readShort(t,e),e+=2,n.sTypoLineGap=a.readShort(t,e),e+=2,n.usWinAscent=a.readUshort(t,e),e+=2,n.usWinDescent=a.readUshort(t,e),e+=2},o["OS/2"].version1=function(t,e,n){var a=o._bin;return e=o["OS/2"].version0(t,e,n),n.ulCodePageRange1=a.readUint(t,e),e+=4,n.ulCodePageRange2=a.readUint(t,e),e+=4},o["OS/2"].version2=function(t,e,n){var a=o._bin;return e=o["OS/2"].version1(t,e,n),n.sxHeight=a.readShort(t,e),e+=2,n.sCapHeight=a.readShort(t,e),e+=2,n.usDefault=a.readUshort(t,e),e+=2,n.usBreak=a.readUshort(t,e),e+=2,n.usMaxContext=a.readUshort(t,e),e+=2},o["OS/2"].version5=function(t,e,n){var a=o._bin;return e=o["OS/2"].version2(t,e,n),n.usLowerOpticalPointSize=a.readUshort(t,e),e+=2,n.usUpperOpticalPointSize=a.readUshort(t,e),e+=2},o.post={},o.post.parse=function(t,e,n){var a=o._bin,r={};return r.version=a.readFixed(t,e),e+=4,r.italicAngle=a.readFixed(t,e),e+=4,r.underlinePosition=a.readShort(t,e),e+=2,r.underlineThickness=a.readShort(t,e),e+=2,r},o==null&&(o={}),o.U==null&&(o.U={}),o.U.codeToGlyph=function(t,e){var n=t.cmap,a=-1;if(n.p0e4!=null?a=n.p0e4:n.p3e1!=null?a=n.p3e1:n.p1e0!=null?a=n.p1e0:n.p0e3!=null&&(a=n.p0e3),a==-1)throw"no familiar platform and encoding!";var r=n.tables[a];if(r.format==0)return e>=r.map.length?0:r.map[e];if(r.format==4){for(var i=-1,s=0;s<r.endCount.length;s++)if(e<=r.endCount[s]){i=s;break}return i==-1||r.startCount[i]>e?0:65535&(r.idRangeOffset[i]!=0?r.glyphIdArray[e-r.startCount[i]+(r.idRangeOffset[i]>>1)-(r.idRangeOffset.length-i)]:e+r.idDelta[i])}if(r.format==12){if(e>r.groups[r.groups.length-1][1])return 0;for(s=0;s<r.groups.length;s++){var l=r.groups[s];if(l[0]<=e&&e<=l[1])return l[2]+(e-l[0])}return 0}throw"unknown cmap table format "+r.format},o.U.glyphToPath=function(t,e){var n={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[e]){var a=t.SVG.entries[e];return a==null?n:(typeof a=="string"&&(a=o.SVG.toPath(a),t.SVG.entries[e]=a),a)}if(t.CFF){var r={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},i=t.CFF,s=t.CFF.Private;if(i.ROS){for(var l=0;i.FDSelect[l+2]<=e;)l+=2;s=i.FDArray[i.FDSelect[l+1]].Private}o.U._drawCFF(t.CFF.CharStrings[e],r,i,s,n)}else t.glyf&&o.U._drawGlyf(e,t,n);return n},o.U._drawGlyf=function(t,e,n){var a=e.glyf[t];a==null&&(a=e.glyf[t]=o.glyf._parseGlyf(e,t)),a!=null&&(a.noc>-1?o.U._simpleGlyph(a,n):o.U._compoGlyph(a,e,n))},o.U._simpleGlyph=function(t,e){for(var n=0;n<t.noc;n++){for(var a=n==0?0:t.endPts[n-1]+1,r=t.endPts[n],i=a;i<=r;i++){var s=i==a?r:i-1,l=i==r?a:i+1,f=1&t.flags[i],u=1&t.flags[s],h=1&t.flags[l],d=t.xs[i],p=t.ys[i];if(i==a)if(f){if(!u){o.U.P.moveTo(e,d,p);continue}o.U.P.moveTo(e,t.xs[s],t.ys[s])}else u?o.U.P.moveTo(e,t.xs[s],t.ys[s]):o.U.P.moveTo(e,(t.xs[s]+d)/2,(t.ys[s]+p)/2);f?u&&o.U.P.lineTo(e,d,p):h?o.U.P.qcurveTo(e,d,p,t.xs[l],t.ys[l]):o.U.P.qcurveTo(e,d,p,(d+t.xs[l])/2,(p+t.ys[l])/2)}o.U.P.closePath(e)}},o.U._compoGlyph=function(t,e,n){for(var a=0;a<t.parts.length;a++){var r={cmds:[],crds:[]},i=t.parts[a];o.U._drawGlyf(i.glyphIndex,e,r);for(var s=i.m,l=0;l<r.crds.length;l+=2){var f=r.crds[l],u=r.crds[l+1];n.crds.push(f*s.a+u*s.b+s.tx),n.crds.push(f*s.c+u*s.d+s.ty)}for(l=0;l<r.cmds.length;l++)n.cmds.push(r.cmds[l])}},o.U._getGlyphClass=function(t,e){var n=o._lctf.getInterval(e,t);return n==-1?0:e[n+2]},o.U._applySubs=function(t,e,n,a){for(var r=t.length-e-1,i=0;i<n.tabs.length;i++)if(n.tabs[i]!=null){var s,l=n.tabs[i];if(!l.coverage||(s=o._lctf.coverageIndex(l.coverage,t[e]))!=-1){if(n.ltype==1)t[e],l.fmt==1?t[e]=t[e]+l.delta:t[e]=l.newg[s];else if(n.ltype==4)for(var f=l.vals[s],u=0;u<f.length;u++){var h=f[u],d=h.chain.length;if(!(d>r)){for(var p=!0,_=0,S=0;S<d;S++){for(;t[e+_+(1+S)]==-1;)_++;h.chain[S]!=t[e+_+(1+S)]&&(p=!1)}if(p){for(t[e]=h.nglyph,S=0;S<d+_;S++)t[e+S+1]=-1;break}}}else if(n.ltype==5&&l.fmt==2)for(var b=o._lctf.getInterval(l.cDef,t[e]),v=l.cDef[b+2],U=l.scset[v],w=0;w<U.length;w++){var k=U[w],T=k.input;if(!(T.length>r)){for(p=!0,S=0;S<T.length;S++){var G=o._lctf.getInterval(l.cDef,t[e+1+S]);if(b==-1&&l.cDef[G+2]!=T[S]){p=!1;break}}if(p){var C=k.substLookupRecords;for(u=0;u<C.length;u+=2)C[u],C[u+1]}}}else if(n.ltype==6&&l.fmt==3){if(!o.U._glsCovered(t,l.backCvg,e-l.backCvg.length)||!o.U._glsCovered(t,l.inptCvg,e)||!o.U._glsCovered(t,l.ahedCvg,e+l.inptCvg.length))continue;var E=l.lookupRec;for(w=0;w<E.length;w+=2){b=E[w];var c=a[E[w+1]];o.U._applySubs(t,e+b,c,a)}}}}},o.U._glsCovered=function(t,e,n){for(var a=0;a<e.length;a++)if(o._lctf.coverageIndex(e[a],t[n+a])==-1)return!1;return!0},o.U.glyphsToPath=function(t,e,n){for(var a={cmds:[],crds:[]},r=0,i=0;i<e.length;i++){var s=e[i];if(s!=-1){for(var l=i<e.length-1&&e[i+1]!=-1?e[i+1]:0,f=o.U.glyphToPath(t,s),u=0;u<f.crds.length;u+=2)a.crds.push(f.crds[u]+r),a.crds.push(f.crds[u+1]);for(n&&a.cmds.push(n),u=0;u<f.cmds.length;u++)a.cmds.push(f.cmds[u]);n&&a.cmds.push("X"),r+=t.hmtx.aWidth[s],i<e.length-1&&(r+=o.U.getPairAdjustment(t,s,l))}}return a},o.U.P={},o.U.P.moveTo=function(t,e,n){t.cmds.push("M"),t.crds.push(e,n)},o.U.P.lineTo=function(t,e,n){t.cmds.push("L"),t.crds.push(e,n)},o.U.P.curveTo=function(t,e,n,a,r,i,s){t.cmds.push("C"),t.crds.push(e,n,a,r,i,s)},o.U.P.qcurveTo=function(t,e,n,a,r){t.cmds.push("Q"),t.crds.push(e,n,a,r)},o.U.P.closePath=function(t){t.cmds.push("Z")},o.U._drawCFF=function(t,e,n,a,r){for(var i=e.stack,s=e.nStems,l=e.haveWidth,f=e.width,u=e.open,h=0,d=e.x,p=e.y,_=0,S=0,b=0,v=0,U=0,w=0,k=0,T=0,G=0,C=0,E={val:0,size:0};h<t.length;){o.CFF.getCharString(t,h,E);var c=E.val;if(h+=E.size,c=="o1"||c=="o18")i.length%2!=0&&!l&&(f=i.shift()+a.nominalWidthX),s+=i.length>>1,i.length=0,l=!0;else if(c=="o3"||c=="o23")i.length%2!=0&&!l&&(f=i.shift()+a.nominalWidthX),s+=i.length>>1,i.length=0,l=!0;else if(c=="o4")i.length>1&&!l&&(f=i.shift()+a.nominalWidthX,l=!0),u&&o.U.P.closePath(r),p+=i.pop(),o.U.P.moveTo(r,d,p),u=!0;else if(c=="o5")for(;i.length>0;)d+=i.shift(),p+=i.shift(),o.U.P.lineTo(r,d,p);else if(c=="o6"||c=="o7")for(var F=i.length,x=c=="o6",R=0;R<F;R++){var D=i.shift();x?d+=D:p+=D,x=!x,o.U.P.lineTo(r,d,p)}else if(c=="o8"||c=="o24"){F=i.length;for(var M=0;M+6<=F;)_=d+i.shift(),S=p+i.shift(),b=_+i.shift(),v=S+i.shift(),d=b+i.shift(),p=v+i.shift(),o.U.P.curveTo(r,_,S,b,v,d,p),M+=6;c=="o24"&&(d+=i.shift(),p+=i.shift(),o.U.P.lineTo(r,d,p))}else{if(c=="o11")break;if(c=="o1234"||c=="o1235"||c=="o1236"||c=="o1237")c=="o1234"&&(S=p,b=(_=d+i.shift())+i.shift(),C=v=S+i.shift(),w=v,T=p,d=(k=(U=(G=b+i.shift())+i.shift())+i.shift())+i.shift(),o.U.P.curveTo(r,_,S,b,v,G,C),o.U.P.curveTo(r,U,w,k,T,d,p)),c=="o1235"&&(_=d+i.shift(),S=p+i.shift(),b=_+i.shift(),v=S+i.shift(),G=b+i.shift(),C=v+i.shift(),U=G+i.shift(),w=C+i.shift(),k=U+i.shift(),T=w+i.shift(),d=k+i.shift(),p=T+i.shift(),i.shift(),o.U.P.curveTo(r,_,S,b,v,G,C),o.U.P.curveTo(r,U,w,k,T,d,p)),c=="o1236"&&(_=d+i.shift(),S=p+i.shift(),b=_+i.shift(),C=v=S+i.shift(),w=v,k=(U=(G=b+i.shift())+i.shift())+i.shift(),T=w+i.shift(),d=k+i.shift(),o.U.P.curveTo(r,_,S,b,v,G,C),o.U.P.curveTo(r,U,w,k,T,d,p)),c=="o1237"&&(_=d+i.shift(),S=p+i.shift(),b=_+i.shift(),v=S+i.shift(),G=b+i.shift(),C=v+i.shift(),U=G+i.shift(),w=C+i.shift(),k=U+i.shift(),T=w+i.shift(),Math.abs(k-d)>Math.abs(T-p)?d=k+i.shift():p=T+i.shift(),o.U.P.curveTo(r,_,S,b,v,G,C),o.U.P.curveTo(r,U,w,k,T,d,p));else if(c=="o14"){if(i.length>0&&!l&&(f=i.shift()+n.nominalWidthX,l=!0),i.length==4){var N=i.shift(),z=i.shift(),P=i.shift(),A=i.shift(),O=o.CFF.glyphBySE(n,P),I=o.CFF.glyphBySE(n,A);o.U._drawCFF(n.CharStrings[O],e,n,a,r),e.x=N,e.y=z,o.U._drawCFF(n.CharStrings[I],e,n,a,r)}u&&(o.U.P.closePath(r),u=!1)}else if(c=="o19"||c=="o20")i.length%2!=0&&!l&&(f=i.shift()+a.nominalWidthX),s+=i.length>>1,i.length=0,l=!0,h+=s+7>>3;else if(c=="o21")i.length>2&&!l&&(f=i.shift()+a.nominalWidthX,l=!0),p+=i.pop(),d+=i.pop(),u&&o.U.P.closePath(r),o.U.P.moveTo(r,d,p),u=!0;else if(c=="o22")i.length>1&&!l&&(f=i.shift()+a.nominalWidthX,l=!0),d+=i.pop(),u&&o.U.P.closePath(r),o.U.P.moveTo(r,d,p),u=!0;else if(c=="o25"){for(;i.length>6;)d+=i.shift(),p+=i.shift(),o.U.P.lineTo(r,d,p);_=d+i.shift(),S=p+i.shift(),b=_+i.shift(),v=S+i.shift(),d=b+i.shift(),p=v+i.shift(),o.U.P.curveTo(r,_,S,b,v,d,p)}else if(c=="o26")for(i.length%2&&(d+=i.shift());i.length>0;)_=d,S=p+i.shift(),d=b=_+i.shift(),p=(v=S+i.shift())+i.shift(),o.U.P.curveTo(r,_,S,b,v,d,p);else if(c=="o27")for(i.length%2&&(p+=i.shift());i.length>0;)S=p,b=(_=d+i.shift())+i.shift(),v=S+i.shift(),d=b+i.shift(),p=v,o.U.P.curveTo(r,_,S,b,v,d,p);else if(c=="o10"||c=="o29"){var B=c=="o10"?a:n;if(i.length==0)console.debug("error: empty stack");else{var L=i.pop(),V=B.Subrs[L+B.Bias];e.x=d,e.y=p,e.nStems=s,e.haveWidth=l,e.width=f,e.open=u,o.U._drawCFF(V,e,n,a,r),d=e.x,p=e.y,s=e.nStems,l=e.haveWidth,f=e.width,u=e.open}}else if(c=="o30"||c=="o31"){var q=i.length,$=(M=0,c=="o31");for(M+=q-(F=-3&q);M<F;)$?(S=p,b=(_=d+i.shift())+i.shift(),p=(v=S+i.shift())+i.shift(),F-M==5?(d=b+i.shift(),M++):d=b,$=!1):(_=d,S=p+i.shift(),b=_+i.shift(),v=S+i.shift(),d=b+i.shift(),F-M==5?(p=v+i.shift(),M++):p=v,$=!0),o.U.P.curveTo(r,_,S,b,v,d,p),M+=4}else{if((c+"").charAt(0)=="o")throw console.debug("Unknown operation: "+c,t),c;i.push(c)}}}e.x=d,e.y=p,e.nStems=s,e.haveWidth=l,e.width=f,e.open=u};var y=o,m={Typr:y};return g.Typr=y,g.default=m,Object.defineProperty(g,"__esModule",{value:!0}),g}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function Wt(){return function(g){var o=Uint8Array,y=Uint16Array,m=Uint32Array,t=new o([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new o([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),n=new o([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=function(c,F){for(var x=new y(31),R=0;R<31;++R)x[R]=F+=1<<c[R-1];var D=new m(x[30]);for(R=1;R<30;++R)for(var M=x[R];M<x[R+1];++M)D[M]=M-x[R]<<5|R;return[x,D]},r=a(t,2),i=r[0],s=r[1];i[28]=258,s[258]=28;for(var l=a(e,0)[0],f=new y(32768),u=0;u<32768;++u){var h=(43690&u)>>>1|(21845&u)<<1;h=(61680&(h=(52428&h)>>>2|(13107&h)<<2))>>>4|(3855&h)<<4,f[u]=((65280&h)>>>8|(255&h)<<8)>>>1}var d=function(c,F,x){for(var R=c.length,D=0,M=new y(F);D<R;++D)++M[c[D]-1];var N,z=new y(F);for(D=0;D<F;++D)z[D]=z[D-1]+M[D-1]<<1;{N=new y(1<<F);var P=15-F;for(D=0;D<R;++D)if(c[D])for(var A=D<<4|c[D],O=F-c[D],I=z[c[D]-1]++<<O,B=I|(1<<O)-1;I<=B;++I)N[f[I]>>>P]=A}return N},p=new o(288);for(u=0;u<144;++u)p[u]=8;for(u=144;u<256;++u)p[u]=9;for(u=256;u<280;++u)p[u]=7;for(u=280;u<288;++u)p[u]=8;var _=new o(32);for(u=0;u<32;++u)_[u]=5;var S=d(p,9),b=d(_,5),v=function(c){for(var F=c[0],x=1;x<c.length;++x)c[x]>F&&(F=c[x]);return F},U=function(c,F,x){var R=F/8|0;return(c[R]|c[R+1]<<8)>>(7&F)&x},w=function(c,F){var x=F/8|0;return(c[x]|c[x+1]<<8|c[x+2]<<16)>>(7&F)},k=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],T=function(c,F,x){var R=new Error(F||k[c]);if(R.code=c,Error.captureStackTrace&&Error.captureStackTrace(R,T),!x)throw R;return R},G=function(c,F,x){var R=c.length;if(!R||x&&!x.l&&R<5)return F||new o(0);var D=!F||x,M=!x||x.i;x||(x={}),F||(F=new o(3*R));var N,z=function(J){var Te=F.length;if(J>Te){var ye=new o(Math.max(2*Te,J));ye.set(F),F=ye}},P=x.f||0,A=x.p||0,O=x.b||0,I=x.l,B=x.d,L=x.m,V=x.n,q=8*R;do{if(!I){x.f=P=U(c,A,1);var $=U(c,A+1,3);if(A+=3,!$){var se=c[(ke=((N=A)/8|0)+(7&N&&1)+4)-4]|c[ke-3]<<8,Y=ke+se;if(Y>R){M&&T(0);break}D&&z(O+se),F.set(c.subarray(ke,Y),O),x.b=O+=se,x.p=A=8*Y;continue}if($==1)I=S,B=b,L=9,V=5;else if($==2){var W=U(c,A,31)+257,ee=U(c,A+10,15)+4,fe=W+U(c,A+5,31)+1;A+=14;for(var K=new o(fe),ue=new o(19),oe=0;oe<ee;++oe)ue[n[oe]]=U(c,A+3*oe,7);A+=3*ee;var pe=v(ue),Ye=(1<<pe)-1,De=d(ue,pe);for(oe=0;oe<fe;){var ke,ge=De[U(c,A,Ye)];if(A+=15&ge,(ke=ge>>>4)<16)K[oe++]=ke;else{var ve=0,Se=0;for(ke==16?(Se=3+U(c,A,3),A+=2,ve=K[oe-1]):ke==17?(Se=3+U(c,A,7),A+=3):ke==18&&(Se=11+U(c,A,127),A+=7);Se--;)K[oe++]=ve}}var Ce=K.subarray(0,W),he=K.subarray(W);L=v(Ce),V=v(he),I=d(Ce,L),B=d(he,V)}else T(1);if(A>q){M&&T(0);break}}D&&z(O+131072);for(var Le=(1<<L)-1,j=(1<<V)-1,ce=A;;ce=A){var ne=(ve=I[w(c,A)&Le])>>>4;if((A+=15&ve)>q){M&&T(0);break}if(ve||T(2),ne<256)F[O++]=ne;else{if(ne==256){ce=A,I=null;break}var ae=ne-254;if(ne>264){var le=t[oe=ne-257];ae=U(c,A,(1<<le)-1)+i[oe],A+=le}var me=B[w(c,A)&j],Q=me>>>4;if(me||T(3),A+=15&me,he=l[Q],Q>3&&(le=e[Q],he+=w(c,A)&(1<<le)-1,A+=le),A>q){M&&T(0);break}D&&z(O+131072);for(var _e=O+ae;O<_e;O+=4)F[O]=F[O-he],F[O+1]=F[O+1-he],F[O+2]=F[O+2-he],F[O+3]=F[O+3-he];O=_e}}x.l=I,x.p=ce,x.b=O,I&&(P=1,x.m=L,x.d=B,x.n=V)}while(!P);return O==F.length?F:function(J,Te,ye){(ye==null||ye>J.length)&&(ye=J.length);var we=new(J instanceof y?y:J instanceof m?m:o)(ye-Te);return we.set(J.subarray(Te,ye)),we}(F,0,O)},C=new o(0),E=typeof TextDecoder<"u"&&new TextDecoder;try{E.decode(C,{stream:!0})}catch{}return g.convert_streams=function(c){var F=new DataView(c),x=0;function R(){var W=F.getUint16(x);return x+=2,W}function D(){var W=F.getUint32(x);return x+=4,W}function M(W){se.setUint16(Y,W),Y+=2}function N(W){se.setUint32(Y,W),Y+=4}for(var z={signature:D(),flavor:D(),length:D(),numTables:R(),reserved:R(),totalSfntSize:D(),majorVersion:R(),minorVersion:R(),metaOffset:D(),metaLength:D(),metaOrigLength:D(),privOffset:D(),privLength:D()},P=0;Math.pow(2,P)<=z.numTables;)P++;P--;for(var A=16*Math.pow(2,P),O=16*z.numTables-A,I=12,B=[],L=0;L<z.numTables;L++)B.push({tag:D(),offset:D(),compLength:D(),origLength:D(),origChecksum:D()}),I+=16;var V,q=new Uint8Array(12+16*B.length+B.reduce(function(W,ee){return W+ee.origLength+4},0)),$=q.buffer,se=new DataView($),Y=0;return N(z.flavor),M(z.numTables),M(A),M(P),M(O),B.forEach(function(W){N(W.tag),N(W.origChecksum),N(I),N(W.origLength),W.outOffset=I,(I+=W.origLength)%4!=0&&(I+=4-I%4)}),B.forEach(function(W){var ee,fe=c.slice(W.offset,W.offset+W.compLength);if(W.compLength!=W.origLength){var K=new Uint8Array(W.origLength);ee=new Uint8Array(fe,2),G(ee,K)}else K=new Uint8Array(fe);q.set(K,W.outOffset);var ue=0;(I=W.outOffset+W.origLength)%4!=0&&(ue=4-I%4),q.set(new Uint8Array(ue).buffer,W.outOffset+W.origLength),V=I+ue}),$.slice(0,V)},Object.defineProperty(g,"__esModule",{value:!0}),g}({}).convert_streams}function Nt(g,o){const y={M:2,L:2,Q:4,C:6,Z:0},m={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},t=1,e=2,n=4,a=8,r=16,i=32;let s;function l(k){if(!s){const T={R:e,L:t,D:n,C:r,U:i,T:a};s=new Map;for(let G in m){let C=0;m[G].split(",").forEach(E=>{let[c,F]=E.split("+");c=parseInt(c,36),F=F?parseInt(F,36):0,s.set(C+=c,T[G]);for(let x=F;x--;)s.set(++C,T[G])})}}return s.get(k)||i}const f=1,u=2,h=3,d=4,p=[null,"isol","init","fina","medi"];function _(k){const T=new Uint8Array(k.length);let G=i,C=f,E=-1;for(let c=0;c<k.length;c++){const F=k.codePointAt(c);let x=l(F)|0,R=f;x&a||(G&(t|n|r)?x&(e|n|r)?(R=h,(C===f||C===h)&&T[E]++):x&(t|i)&&(C===u||C===d)&&T[E]--:G&(e|i)&&(C===u||C===d)&&T[E]--,C=T[c]=R,G=x,E=c,F>65535&&c++)}return T}function S(k,T){const G=[];for(let E=0;E<T.length;E++){const c=T.codePointAt(E);c>65535&&E++,G.push(g.U.codeToGlyph(k,c))}const C=k.GSUB;if(C){const{lookupList:E,featureList:c}=C;let F;const x=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,R=[];c.forEach(D=>{if(x.test(D.tag))for(let M=0;M<D.tab.length;M++){if(R[D.tab[M]])continue;R[D.tab[M]]=!0;const N=E[D.tab[M]],z=/^(isol|init|fina|medi)$/.test(D.tag);z&&!F&&(F=_(T));for(let P=0;P<G.length;P++)(!F||!z||p[F[P]]===D.tag)&&g.U._applySubs(G,P,N,E)}})}return G}function b(k,T){const G=new Int16Array(T.length*3);let C=0;for(;C<T.length;C++){const x=T[C];if(x===-1)continue;G[C*3+2]=k.hmtx.aWidth[x];const R=k.GPOS;if(R){const D=R.lookupList;for(let M=0;M<D.length;M++){const N=D[M];for(let z=0;z<N.tabs.length;z++){const P=N.tabs[z];if(N.ltype===1){if(g._lctf.coverageIndex(P.coverage,x)!==-1&&P.pos){F(P.pos,C);break}}else if(N.ltype===2){let A=null,O=E();if(O!==-1){const I=g._lctf.coverageIndex(P.coverage,T[O]);if(I!==-1){if(P.fmt===1){const B=P.pairsets[I];for(let L=0;L<B.length;L++)B[L].gid2===x&&(A=B[L])}else if(P.fmt===2){const B=g.U._getGlyphClass(T[O],P.classDef1),L=g.U._getGlyphClass(x,P.classDef2);A=P.matrix[B][L]}if(A){A.val1&&F(A.val1,O),A.val2&&F(A.val2,C);break}}}}else if(N.ltype===4){const A=g._lctf.coverageIndex(P.markCoverage,x);if(A!==-1){const O=E(c),I=O===-1?-1:g._lctf.coverageIndex(P.baseCoverage,T[O]);if(I!==-1){const B=P.markArray[A],L=P.baseArray[I][B.markClass];G[C*3]=L.x-B.x+G[O*3]-G[O*3+2],G[C*3+1]=L.y-B.y+G[O*3+1];break}}}else if(N.ltype===6){const A=g._lctf.coverageIndex(P.mark1Coverage,x);if(A!==-1){const O=E();if(O!==-1){const I=T[O];if(v(k,I)===3){const B=g._lctf.coverageIndex(P.mark2Coverage,I);if(B!==-1){const L=P.mark1Array[A],V=P.mark2Array[B][L.markClass];G[C*3]=V.x-L.x+G[O*3]-G[O*3+2],G[C*3+1]=V.y-L.y+G[O*3+1];break}}}}}}}}else if(k.kern&&!k.cff){const D=E();if(D!==-1){const M=k.kern.glyph1.indexOf(T[D]);if(M!==-1){const N=k.kern.rval[M].glyph2.indexOf(x);N!==-1&&(G[D*3+2]+=k.kern.rval[M].vals[N])}}}}return G;function E(x){for(let R=C-1;R>=0;R--)if(T[R]!==-1&&(!x||x(T[R])))return R;return-1}function c(x){return v(k,x)===1}function F(x,R){for(let D=0;D<3;D++)G[R*3+D]+=x[D]||0}}function v(k,T){const G=k.GDEF&&k.GDEF.glyphClassDef;return G?g.U._getGlyphClass(T,G):0}function U(...k){for(let T=0;T<k.length;T++)if(typeof k[T]=="number")return k[T]}function w(k){const T=Object.create(null),G=k["OS/2"],C=k.hhea,E=k.head.unitsPerEm,c=U(G&&G.sTypoAscender,C&&C.ascender,E),F={unitsPerEm:E,ascender:c,descender:U(G&&G.sTypoDescender,C&&C.descender,0),capHeight:U(G&&G.sCapHeight,c),xHeight:U(G&&G.sxHeight,c),lineGap:U(G&&G.sTypoLineGap,C&&C.lineGap),supportsCodePoint(x){return g.U.codeToGlyph(k,x)>0},forEachGlyph(x,R,D,M){let N=0;const z=1/F.unitsPerEm*R,P=S(k,x);let A=0;const O=b(k,P);return P.forEach((I,B)=>{if(I!==-1){let L=T[I];if(!L){const{cmds:V,crds:q}=g.U.glyphToPath(k,I);let $="",se=0;for(let K=0,ue=V.length;K<ue;K++){const oe=y[V[K]];$+=V[K];for(let pe=1;pe<=oe;pe++)$+=(pe>1?",":"")+q[se++]}let Y,W,ee,fe;if(q.length){Y=W=1/0,ee=fe=-1/0;for(let K=0,ue=q.length;K<ue;K+=2){let oe=q[K],pe=q[K+1];oe<Y&&(Y=oe),pe<W&&(W=pe),oe>ee&&(ee=oe),pe>fe&&(fe=pe)}}else Y=ee=W=fe=0;L=T[I]={index:I,advanceWidth:k.hmtx.aWidth[I],xMin:Y,yMin:W,xMax:ee,yMax:fe,path:$}}M.call(null,L,N+O[B*3]*z,O[B*3+1]*z,A),N+=O[B*3+2]*z,D&&(N+=D*R)}A+=x.codePointAt(A)>65535?2:1}),N}};return F}return function(T){const G=new Uint8Array(T,0,4),C=g._bin.readASCII(G,0,4);if(C==="wOFF")T=o(T);else if(C==="wOF2")throw new Error("woff2 fonts not supported");return w(g.parse(T)[0])}}const zt=Pe({name:"Typr Font Parser",dependencies:[Lt,Wt,Nt],init(g,o,y){const m=g(),t=o();return y(m,t)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function Vt(){return function(g){var o=function(){this.buckets=new Map};o.prototype.add=function(b){var v=b>>5;this.buckets.set(v,(this.buckets.get(v)||0)|1<<(31&b))},o.prototype.has=function(b){var v=this.buckets.get(b>>5);return v!==void 0&&(v&1<<(31&b))!=0},o.prototype.serialize=function(){var b=[];return this.buckets.forEach(function(v,U){b.push((+U).toString(36)+":"+v.toString(36))}),b.join(",")},o.prototype.deserialize=function(b){var v=this;this.buckets.clear(),b.split(",").forEach(function(U){var w=U.split(":");v.buckets.set(parseInt(w[0],36),parseInt(w[1],36))})};var y=Math.pow(2,8),m=y-1,t=~m;function e(b){var v=function(w){return w&t}(b).toString(16),U=function(w){return(w&t)+y-1}(b).toString(16);return"codepoint-index/plane"+(b>>16)+"/"+v+"-"+U+".json"}function n(b,v){var U=b&m,w=v.codePointAt(U/6|0);return((w=(w||48)-48)&1<<U%6)!=0}function a(b,v){var U;(U=b,U.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(w){return w.split("-").map(function(k){return parseInt(k.trim(),16)})})).forEach(function(w){var k=w[0],T=w[1];T===void 0&&(T=k),v(k,T)})}function r(b,v){a(b,function(U,w){for(var k=U;k<=w;k++)v(k)})}var i={},s={},l=new WeakMap,f="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function u(b){var v=l.get(b);return v||(v=new o,r(b.ranges,function(U){return v.add(U)}),l.set(b,v)),v}var h,d=new Map;function p(b,v,U){return b[v]?v:b[U]?U:function(w){for(var k in w)return k}(b)}function _(b,v){var U=v;if(!b.includes(U)){U=1/0;for(var w=0;w<b.length;w++)Math.abs(b[w]-v)<Math.abs(U-v)&&(U=b[w])}return U}function S(b){return h||(h=new Set,r("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(v){h.add(v)})),h.has(b)}return g.CodePointSet=o,g.clearCache=function(){i={},s={}},g.getFontsForString=function(b,v){v===void 0&&(v={});var U,w=v.lang;w===void 0&&(w=new RegExp("\\p{Script=Hangul}","u").test(U=b)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(U)?"ja":"en");var k=v.category;k===void 0&&(k="sans-serif");var T=v.style;T===void 0&&(T="normal");var G=v.weight;G===void 0&&(G=400);var C=(v.dataUrl||f).replace(/\/$/g,""),E=new Map,c=new Uint8Array(b.length),F={},x={},R=new Array(b.length),D=new Map,M=!1;function N(A){var O=d.get(A);return O||(O=fetch(C+"/"+A).then(function(I){if(!I.ok)throw new Error(I.statusText);return I.json().then(function(B){if(!Array.isArray(B)||B[0]!==1)throw new Error("Incorrect schema version; need 1, got "+B[0]);return B[1]})}).catch(function(I){if(C!==f)return M||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+C+'", trying default CDN. '+I.message),M=!0),C=f,d.delete(A),N(A);throw I}),d.set(A,O)),O}for(var z=function(A){var O=b.codePointAt(A),I=e(O);R[A]=I,i[I]||D.has(I)||D.set(I,N(I).then(function(B){i[I]=B})),O>65535&&(A++,P=A)},P=0;P<b.length;P++)z(P);return Promise.all(D.values()).then(function(){D.clear();for(var A=function(I){var B=b.codePointAt(I),L=null,V=i[R[I]],q=void 0;for(var $ in V){var se=x[$];if(se===void 0&&(se=x[$]=new RegExp($).test(w||"en")),se){for(var Y in q=$,V[$])if(n(B,V[$][Y])){L=Y;break}break}}if(!L){e:for(var W in V)if(W!==q){for(var ee in V[W])if(n(B,V[W][ee])){L=ee;break e}}}L||(console.debug("No font coverage for U+"+B.toString(16)),L="latin"),R[I]=L,s[L]||D.has(L)||D.set(L,N("font-meta/"+L+".json").then(function(fe){s[L]=fe})),B>65535&&(I++,O=I)},O=0;O<b.length;O++)A(O);return Promise.all(D.values())}).then(function(){for(var A,O=null,I=0;I<b.length;I++){var B=b.codePointAt(I);if(O&&(S(B)||u(O).has(B)))c[I]=c[I-1];else{O=s[R[I]];var L=F[O.id];if(!L){var V=O.typeforms,q=p(V,k,"sans-serif"),$=p(V[q],T,"normal"),se=_((A=V[q])===null||A===void 0?void 0:A[$],G);L=F[O.id]=C+"/font-files/"+O.id+"/"+q+"."+$+"."+se+".woff"}var Y=E.get(L);Y==null&&(Y=E.size,E.set(L,Y)),c[I]=Y}B>65535&&(I++,c[I]=c[I-1])}return{fontUrls:Array.from(E.keys()),chars:c}})},Object.defineProperty(g,"__esModule",{value:!0}),g}({})}function jt(g,o){const y=Object.create(null),m=Object.create(null);function t(n,a){const r=i=>{console.error(`Failure loading font ${n}`,i)};try{const i=new XMLHttpRequest;i.open("get",n,!0),i.responseType="arraybuffer",i.onload=function(){if(i.status>=400)r(new Error(i.statusText));else if(i.status>0)try{const s=g(i.response);s.src=n,a(s)}catch(s){r(s)}},i.onerror=r,i.send()}catch(i){r(i)}}function e(n,a){let r=y[n];r?a(r):m[n]?m[n].push(a):(m[n]=[a],t(n,i=>{i.src=n,y[n]=i,m[n].forEach(s=>s(i)),delete m[n]}))}return function(n,a,{lang:r,fonts:i=[],style:s="normal",weight:l="normal",unicodeFontsURL:f}={}){const u=new Uint8Array(n.length),h=[];n.length||S();const d=new Map,p=[];if(s!=="italic"&&(s="normal"),typeof l!="number"&&(l=l==="bold"?700:400),i&&!Array.isArray(i)&&(i=[i]),i=i.slice().filter(v=>!v.lang||v.lang.test(r)).reverse(),i.length){let k=0;(function T(G=0){for(let C=G,E=n.length;C<E;C++){const c=n.codePointAt(C);if(k===1&&h[u[C-1]].supportsCodePoint(c)||C>0&&/\s/.test(n[C]))u[C]=u[C-1],k===2&&(p[p.length-1][1]=C);else for(let F=u[C],x=i.length;F<=x;F++)if(F===x){const R=k===2?p[p.length-1]:p[p.length]=[C,C];R[1]=C,k=2}else{u[C]=F;const{src:R,unicodeRange:D}=i[F];if(!D||b(c,D)){const M=y[R];if(!M){e(R,()=>{T(C)});return}if(M.supportsCodePoint(c)){let N=d.get(M);typeof N!="number"&&(N=h.length,h.push(M),d.set(M,N)),u[C]=N,k=1;break}}}c>65535&&C+1<E&&(u[C+1]=u[C],C++,k===2&&(p[p.length-1][1]=C))}_()})()}else p.push([0,n.length-1]),_();function _(){if(p.length){const v=p.map(U=>n.substring(U[0],U[1]+1)).join(`
`);o.getFontsForString(v,{lang:r||void 0,style:s,weight:l,dataUrl:f}).then(({fontUrls:U,chars:w})=>{const k=h.length;let T=0;p.forEach(C=>{for(let E=0,c=C[1]-C[0];E<=c;E++)u[C[0]+E]=w[T++]+k;T++});let G=0;U.forEach((C,E)=>{e(C,c=>{h[E+k]=c,++G===U.length&&S()})})})}else S()}function S(){a({chars:u,fonts:h})}function b(v,U){for(let w=0;w<U.length;w++){const[k,T=k]=U[w];if(k<=v&&v<=T)return!0}return!1}}}const Ht=Pe({name:"FontResolver",dependencies:[jt,zt,Vt],init(g,o,y){return g(o,y())}});function Xt(g,o){const m=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,t="[^\\S\\u00A0]",e=new RegExp(`${t}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function n({text:h,lang:d,fonts:p,style:_,weight:S,preResolvedFonts:b,unicodeFontsURL:v},U){const w=({chars:k,fonts:T})=>{let G,C;const E=[];for(let c=0;c<k.length;c++)k[c]!==C?(C=k[c],E.push(G={start:c,end:c,fontObj:T[k[c]]})):G.end=c;U(E)};b?w(b):g(h,w,{lang:d,fonts:p,style:_,weight:S,unicodeFontsURL:v})}function a({text:h="",font:d,lang:p,sdfGlyphSize:_=64,fontSize:S=400,fontWeight:b=1,fontStyle:v="normal",letterSpacing:U=0,lineHeight:w="normal",maxWidth:k=1/0,direction:T,textAlign:G="left",textIndent:C=0,whiteSpace:E="normal",overflowWrap:c="normal",anchorX:F=0,anchorY:x=0,metricsOnly:R=!1,unicodeFontsURL:D,preResolvedFonts:M=null,includeCaretPositions:N=!1,chunkedBoundsSize:z=8192,colorRanges:P=null},A){const O=l(),I={fontLoad:0,typesetting:0};h.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),h=h.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),S=+S,U=+U,k=+k,w=w||"normal",C=+C,n({text:h,lang:p,style:v,weight:b,fonts:typeof d=="string"?[{src:d}]:d,unicodeFontsURL:D,preResolvedFonts:M},B=>{I.fontLoad=l()-O;const L=isFinite(k);let V=null,q=null,$=null,se=null,Y=null,W=null,ee=null,fe=null,K=0,ue=0,oe=E!=="nowrap";const pe=new Map,Ye=l();let De=C,ke=0,ge=new f;const ve=[ge];B.forEach(j=>{const{fontObj:ce}=j,{ascender:ne,descender:ae,unitsPerEm:le,lineGap:me,capHeight:Q,xHeight:_e}=ce;let J=pe.get(ce);if(!J){const Z=S/le,te=w==="normal"?(ne-ae+me)*Z:w*S,Be=(te-(ne-ae)*Z)/2,re=Math.min(te,(ne-ae)*Z),X=(ne+ae)/2*Z+re/2;J={index:pe.size,src:ce.src,fontObj:ce,fontSizeMult:Z,unitsPerEm:le,ascender:ne*Z,descender:ae*Z,capHeight:Q*Z,xHeight:_e*Z,lineHeight:te,baseline:-Be-ne*Z,caretTop:X,caretBottom:X-re},pe.set(ce,J)}const{fontSizeMult:Te}=J,ye=h.slice(j.start,j.end+1);let we,Ae;ce.forEachGlyph(ye,S,U,(Z,te,Be,re)=>{te+=ke,re+=j.start,we=te,Ae=Z;const X=h.charAt(re),Ue=Z.advanceWidth*Te,be=ge.count;let H;if("isEmpty"in Z||(Z.isWhitespace=!!X&&new RegExp(t).test(X),Z.canBreakAfter=!!X&&e.test(X),Z.isEmpty=Z.xMin===Z.xMax||Z.yMin===Z.yMax||m.test(X)),!Z.isWhitespace&&!Z.isEmpty&&ue++,oe&&L&&!Z.isWhitespace&&te+Ue+De>k&&be){if(ge.glyphAt(be-1).glyphObj.canBreakAfter)H=new f,De=-te;else for(let Fe=be;Fe--;)if(Fe===0&&c==="break-word"){H=new f,De=-te;break}else if(ge.glyphAt(Fe).glyphObj.canBreakAfter){H=ge.splitAt(Fe+1);const xe=H.glyphAt(0).x;De-=xe;for(let de=H.count;de--;)H.glyphAt(de).x-=xe;break}H&&(ge.isSoftWrapped=!0,ge=H,ve.push(ge),K=k)}let ie=ge.glyphAt(ge.count);ie.glyphObj=Z,ie.x=te+De,ie.y=Be,ie.width=Ue,ie.charIndex=re,ie.fontData=J,X===`
`&&(ge=new f,ve.push(ge),De=-(te+Ue+U*S)+C)}),ke=we+Ae.advanceWidth*Te+U*S});let Se=0;ve.forEach(j=>{let ce=!0;for(let ne=j.count;ne--;){const ae=j.glyphAt(ne);ce&&!ae.glyphObj.isWhitespace&&(j.width=ae.x+ae.width,j.width>K&&(K=j.width),ce=!1);let{lineHeight:le,capHeight:me,xHeight:Q,baseline:_e}=ae.fontData;le>j.lineHeight&&(j.lineHeight=le);const J=_e-j.baseline;J<0&&(j.baseline+=J,j.cap+=J,j.ex+=J),j.cap=Math.max(j.cap,j.baseline+me),j.ex=Math.max(j.ex,j.baseline+Q)}j.baseline-=Se,j.cap-=Se,j.ex-=Se,Se+=j.lineHeight});let Ce=0,he=0;if(F&&(typeof F=="number"?Ce=-F:typeof F=="string"&&(Ce=-K*(F==="left"?0:F==="center"?.5:F==="right"?1:i(F)))),x&&(typeof x=="number"?he=-x:typeof x=="string"&&(he=x==="top"?0:x==="top-baseline"?-ve[0].baseline:x==="top-cap"?-ve[0].cap:x==="top-ex"?-ve[0].ex:x==="middle"?Se/2:x==="bottom"?Se:x==="bottom-baseline"?-ve[ve.length-1].baseline:i(x)*Se)),!R){const j=o.getEmbeddingLevels(h,T);V=new Uint16Array(ue),q=new Uint8Array(ue),$=new Float32Array(ue*2),se={},ee=[1/0,1/0,-1/0,-1/0],fe=[],N&&(W=new Float32Array(h.length*4)),P&&(Y=new Uint8Array(ue*3));let ce=0,ne=-1,ae=-1,le,me;if(ve.forEach((Q,_e)=>{let{count:J,width:Te}=Q;if(J>0){let ye=0;for(let re=J;re--&&Q.glyphAt(re).glyphObj.isWhitespace;)ye++;let we=0,Ae=0;if(G==="center")we=(K-Te)/2;else if(G==="right")we=K-Te;else if(G==="justify"&&Q.isSoftWrapped){let re=0;for(let X=J-ye;X--;)Q.glyphAt(X).glyphObj.isWhitespace&&re++;Ae=(K-Te)/re}if(Ae||we){let re=0;for(let X=0;X<J;X++){let Ue=Q.glyphAt(X);const be=Ue.glyphObj;Ue.x+=we+re,Ae!==0&&be.isWhitespace&&X<J-ye&&(re+=Ae,Ue.width+=Ae)}}const Z=o.getReorderSegments(h,j,Q.glyphAt(0).charIndex,Q.glyphAt(Q.count-1).charIndex);for(let re=0;re<Z.length;re++){const[X,Ue]=Z[re];let be=1/0,H=-1/0;for(let ie=0;ie<J;ie++)if(Q.glyphAt(ie).charIndex>=X){let Fe=ie,xe=ie;for(;xe<J;xe++){let de=Q.glyphAt(xe);if(de.charIndex>Ue)break;xe<J-ye&&(be=Math.min(be,de.x),H=Math.max(H,de.x+de.width))}for(let de=Fe;de<xe;de++){const Oe=Q.glyphAt(de);Oe.x=H-(Oe.x+Oe.width-be)}break}}let te;const Be=re=>te=re;for(let re=0;re<J;re++){const X=Q.glyphAt(re);te=X.glyphObj;const Ue=te.index,be=j.levels[X.charIndex]&1;if(be){const H=o.getMirroredCharacter(h[X.charIndex]);H&&X.fontData.fontObj.forEachGlyph(H,0,0,Be)}if(N){const{charIndex:H,fontData:ie}=X,Fe=X.x+Ce,xe=X.x+X.width+Ce;W[H*4]=be?xe:Fe,W[H*4+1]=be?Fe:xe,W[H*4+2]=Q.baseline+ie.caretBottom+he,W[H*4+3]=Q.baseline+ie.caretTop+he;const de=H-ne;de>1&&s(W,ne,de),ne=H}if(P){const{charIndex:H}=X;for(;H>ae;)ae++,P.hasOwnProperty(ae)&&(me=P[ae])}if(!te.isWhitespace&&!te.isEmpty){const H=ce++,{fontSizeMult:ie,src:Fe,index:xe}=X.fontData,de=se[Fe]||(se[Fe]={});de[Ue]||(de[Ue]={path:te.path,pathBounds:[te.xMin,te.yMin,te.xMax,te.yMax]});const Oe=X.x+Ce,Ke=X.y+Q.baseline+he;$[H*2]=Oe,$[H*2+1]=Ke;const We=Oe+te.xMin*ie,Ne=Ke+te.yMin*ie,ze=Oe+te.xMax*ie,Ve=Ke+te.yMax*ie;We<ee[0]&&(ee[0]=We),Ne<ee[1]&&(ee[1]=Ne),ze>ee[2]&&(ee[2]=ze),Ve>ee[3]&&(ee[3]=Ve),H%z===0&&(le={start:H,end:H,rect:[1/0,1/0,-1/0,-1/0]},fe.push(le)),le.end++;const Ge=le.rect;if(We<Ge[0]&&(Ge[0]=We),Ne<Ge[1]&&(Ge[1]=Ne),ze>Ge[2]&&(Ge[2]=ze),Ve>Ge[3]&&(Ge[3]=Ve),V[H]=Ue,q[H]=xe,P){const Qe=H*3;Y[Qe]=me>>16&255,Y[Qe+1]=me>>8&255,Y[Qe+2]=me&255}}}}}),W){const Q=h.length-ne;Q>1&&s(W,ne,Q)}}const Le=[];pe.forEach(({index:j,src:ce,unitsPerEm:ne,ascender:ae,descender:le,lineHeight:me,capHeight:Q,xHeight:_e})=>{Le[j]={src:ce,unitsPerEm:ne,ascender:ae,descender:le,lineHeight:me,capHeight:Q,xHeight:_e}}),I.typesetting=l()-Ye,A({glyphIds:V,glyphFontIndices:q,glyphPositions:$,glyphData:se,fontData:Le,caretPositions:W,glyphColors:Y,chunkedBounds:fe,fontSize:S,topBaseline:he+ve[0].baseline,blockBounds:[Ce,he-Se,Ce+K,he],visibleBounds:ee,timings:I})})}function r(h,d){a({...h,metricsOnly:!0},p=>{const[_,S,b,v]=p.blockBounds;d({width:b-_,height:v-S})})}function i(h){let d=h.match(/^([\d.]+)%$/),p=d?parseFloat(d[1]):NaN;return isNaN(p)?0:p/100}function s(h,d,p){const _=h[d*4],S=h[d*4+1],b=h[d*4+2],v=h[d*4+3],U=(S-_)/p;for(let w=0;w<p;w++){const k=(d+w)*4;h[k]=_+U*w,h[k+1]=_+U*(w+1),h[k+2]=b,h[k+3]=v}}function l(){return(self.performance||Date).now()}function f(){this.data=[]}const u=["glyphObj","x","y","width","charIndex","fontData"];return f.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/u.length)},glyphAt(h){let d=f.flyweight;return d.data=this.data,d.index=h,d},splitAt(h){let d=new f;return d.data=this.data.splice(h*u.length),d}},f.flyweight=u.reduce((h,d,p,_)=>(Object.defineProperty(h,d,{get(){return this.data[this.index*u.length+p]},set(S){this.data[this.index*u.length+p]=S}}),h),{data:null,index:0}),{typeset:a,measure:r}}const Ie=()=>(self.performance||Date).now(),Je=mt();let lt;function qt(g,o,y,m,t,e,n,a,r,i,s=!0){return s?Jt(g,o,y,m,t,e,n,a,r,i).then(null,l=>(lt||(console.warn("WebGL SDF generation failed, falling back to JS",l),lt=!0),ut(g,o,y,m,t,e,n,a,r,i))):ut(g,o,y,m,t,e,n,a,r,i)}const Xe=[],$t=5;let tt=0;function St(){const g=Ie();for(;Xe.length&&Ie()-g<$t;)Xe.shift()();tt=Xe.length?setTimeout(St,0):0}const Jt=(...g)=>new Promise((o,y)=>{Xe.push(()=>{const m=Ie();try{Je.webgl.generateIntoCanvas(...g),o({timing:Ie()-m})}catch(t){y(t)}}),tt||(tt=setTimeout(St,0))}),Yt=4,Kt=2e3,ft={};let Qt=0;function ut(g,o,y,m,t,e,n,a,r,i){const s="TroikaTextSDFGenerator_JS_"+Qt++%Yt;let l=ft[s];return l||(l=ft[s]={workerModule:Pe({name:s,workerId:s,dependencies:[mt,Ie],init(f,u){const h=f().javascript.generate;return function(...d){const p=u();return{textureData:h(...d),timing:u()-p}}},getTransferables(f){return[f.textureData.buffer]}}),requests:0,idleTimer:null}),l.requests++,clearTimeout(l.idleTimer),l.workerModule(g,o,y,m,t,e).then(({textureData:f,timing:u})=>{const h=Ie(),d=new Uint8Array(f.length*4);for(let p=0;p<f.length;p++)d[p*4+i]=f[p];return Je.webglUtils.renderImageData(n,d,a,r,g,o,1<<3-i),u+=Ie()-h,--l.requests===0&&(l.idleTimer=setTimeout(()=>{Bt(s)},Kt)),{timing:u}})}function Zt(g){g._warm||(Je.webgl.isSupported(g),g._warm=!0)}const er=Je.webglUtils.resizeWebGLCanvasWithoutClearing,Ee={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},tr=new $e;function Re(){return(self.performance||Date).now()}const ht=Object.create(null);function Ut(g,o){g=nr({},g);const y=Re(),m=[];if(g.font&&m.push({label:"user",src:or(g.font)}),g.font=m,g.text=""+g.text,g.sdfGlyphSize=g.sdfGlyphSize||Ee.sdfGlyphSize,g.unicodeFontsURL=g.unicodeFontsURL||Ee.unicodeFontsURL,g.colorRanges!=null){let f={};for(let u in g.colorRanges)if(g.colorRanges.hasOwnProperty(u)){let h=g.colorRanges[u];typeof h!="number"&&(h=tr.set(h).getHex()),f[u]=h}g.colorRanges=f}Object.freeze(g);const{textureWidth:t,sdfExponent:e}=Ee,{sdfGlyphSize:n}=g,a=t/n*4;let r=ht[n];if(!r){const f=document.createElement("canvas");f.width=t,f.height=n*256/a,r=ht[n]={glyphCount:0,sdfGlyphSize:n,sdfCanvas:f,sdfTexture:new Ot(f,void 0,void 0,void 0,it,it),contextLost:!1,glyphsByFont:new Map},r.sdfTexture.generateMipmaps=!1,rr(r)}const{sdfTexture:i,sdfCanvas:s}=r;kt(g).then(f=>{const{glyphIds:u,glyphFontIndices:h,fontData:d,glyphPositions:p,fontSize:_,timings:S}=f,b=[],v=new Float32Array(u.length*4);let U=0,w=0;const k=Re(),T=d.map(F=>{let x=r.glyphsByFont.get(F.src);return x||r.glyphsByFont.set(F.src,x=new Map),x});u.forEach((F,x)=>{const R=h[x],{src:D,unitsPerEm:M}=d[R];let N=T[R].get(F);if(!N){const{path:I,pathBounds:B}=f.glyphData[D][F],L=Math.max(B[2]-B[0],B[3]-B[1])/n*(Ee.sdfMargin*n+.5),V=r.glyphCount++,q=[B[0]-L,B[1]-L,B[2]+L,B[3]+L];T[R].set(F,N={path:I,atlasIndex:V,sdfViewBox:q}),b.push(N)}const{sdfViewBox:z}=N,P=p[w++],A=p[w++],O=_/M;v[U++]=P+z[0]*O,v[U++]=A+z[1]*O,v[U++]=P+z[2]*O,v[U++]=A+z[3]*O,u[x]=N.atlasIndex}),S.quads=(S.quads||0)+(Re()-k);const G=Re();S.sdf={};const C=s.height,E=Math.ceil(r.glyphCount/a),c=Math.pow(2,Math.ceil(Math.log2(E*n)));c>C&&(console.info(`Increasing SDF texture size ${C}->${c}`),er(s,t,c),i.dispose()),Promise.all(b.map(F=>bt(F,r,g.gpuAccelerateSDF).then(({timing:x})=>{S.sdf[F.atlasIndex]=x}))).then(()=>{b.length&&!r.contextLost&&(xt(r),i.needsUpdate=!0),S.sdfTotal=Re()-G,S.total=Re()-y,o(Object.freeze({parameters:g,sdfTexture:i,sdfGlyphSize:n,sdfExponent:e,glyphBounds:v,glyphAtlasIndices:u,glyphColors:f.glyphColors,caretPositions:f.caretPositions,chunkedBounds:f.chunkedBounds,ascender:f.ascender,descender:f.descender,lineHeight:f.lineHeight,capHeight:f.capHeight,xHeight:f.xHeight,topBaseline:f.topBaseline,blockBounds:f.blockBounds,visibleBounds:f.visibleBounds,timings:f.timings}))})}),Promise.resolve().then(()=>{r.contextLost||Zt(s)})}function bt({path:g,atlasIndex:o,sdfViewBox:y},{sdfGlyphSize:m,sdfCanvas:t,contextLost:e},n){if(e)return Promise.resolve({timing:-1});const{textureWidth:a,sdfExponent:r}=Ee,i=Math.max(y[2]-y[0],y[3]-y[1]),s=Math.floor(o/4),l=s%(a/m)*m,f=Math.floor(s/(a/m))*m,u=o%4;return qt(m,m,g,y,i,r,t,l,f,u,n)}function rr(g){const o=g.sdfCanvas;o.addEventListener("webglcontextlost",y=>{console.log("Context Lost",y),y.preventDefault(),g.contextLost=!0}),o.addEventListener("webglcontextrestored",y=>{console.log("Context Restored",y),g.contextLost=!1;const m=[];g.glyphsByFont.forEach(t=>{t.forEach(e=>{m.push(bt(e,g,!0))})}),Promise.all(m).then(()=>{xt(g),g.sdfTexture.needsUpdate=!0})})}function Fr({font:g,characters:o,sdfGlyphSize:y},m){let t=Array.isArray(o)?o.join(`
`):""+o;Ut({font:g,sdfGlyphSize:y,text:t},m)}function nr(g,o){for(let y in o)o.hasOwnProperty(y)&&(g[y]=o[y]);return g}let je;function or(g){return je||(je=typeof document>"u"?{}:document.createElement("a")),je.href=g,je.href}function xt(g){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:o,sdfTexture:y}=g,{width:m,height:t}=o,e=g.sdfCanvas.getContext("webgl");let n=y.image.data;(!n||n.length!==m*t*4)&&(n=new Uint8Array(m*t*4),y.image={width:m,height:t,data:n},y.flipY=!1,y.isDataTexture=!0),e.readPixels(0,0,m,t,e.RGBA,e.UNSIGNED_BYTE,n)}}const ar=Pe({name:"Typesetter",dependencies:[Xt,Ht,Mt],init(g,o,y){return g(o,y())}}),kt=Pe({name:"Typesetter",dependencies:[ar],init(g){return function(o){return new Promise(y=>{g.typeset(o,y)})}},getTransferables(g){const o=[];for(let y in g)g[y]&&g[y].buffer&&o.push(g[y].buffer);return o}});kt.onMainThread;const ct={};function ir(g){let o=ct[g];return o||(o=ct[g]=new ot(1,1,g,g).translate(.5,.5,0)),o}const sr="aTroikaGlyphBounds",dt="aTroikaGlyphIndex",lr="aTroikaGlyphColor";class fr extends Dt{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new At,this.boundingBox=new yt}computeBoundingSphere(){}computeBoundingBox(){}set detail(o){if(o!==this._detail){this._detail=o,(typeof o!="number"||o<1)&&(o=1);let y=ir(o);["position","normal","uv"].forEach(m=>{this.attributes[m]=y.attributes[m].clone()}),this.setIndex(y.getIndex().clone())}}get detail(){return this._detail}set curveRadius(o){o!==this._curveRadius&&(this._curveRadius=o,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(o,y,m,t,e){this.updateAttributeData(sr,o,4),this.updateAttributeData(dt,y,1),this.updateAttributeData(lr,e,3),this._blockBounds=m,this._chunkedBounds=t,this.instanceCount=y.length,this._updateBounds()}_updateBounds(){const o=this._blockBounds;if(o){const{curveRadius:y,boundingBox:m}=this;if(y){const{PI:t,floor:e,min:n,max:a,sin:r,cos:i}=Math,s=t/2,l=t*2,f=Math.abs(y),u=o[0]/f,h=o[2]/f,d=e((u+s)/l)!==e((h+s)/l)?-f:n(r(u)*f,r(h)*f),p=e((u-s)/l)!==e((h-s)/l)?f:a(r(u)*f,r(h)*f),_=e((u+t)/l)!==e((h+t)/l)?f*2:a(f-i(u)*f,f-i(h)*f);m.min.set(d,o[1],y<0?-_:0),m.max.set(p,o[3],y<0?0:_)}else m.min.set(o[0],o[1],0),m.max.set(o[2],o[3],0);m.getBoundingSphere(this.boundingSphere)}}applyClipRect(o){let y=this.getAttribute(dt).count,m=this._chunkedBounds;if(m)for(let t=m.length;t--;){y=m[t].end;let e=m[t].rect;if(e[1]<o.w&&e[3]>o.y&&e[0]<o.z&&e[2]>o.x)break}this.instanceCount=y}updateAttributeData(o,y,m){const t=this.getAttribute(o);y?t&&t.array.length===y.length?(t.array.set(y),t.needsUpdate=!0):(this.setAttribute(o,new Gt(y,m)),delete this._maxInstanceCount,this.dispose()):t&&this.deleteAttribute(o)}}const ur=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,hr=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,cr=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,dr=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function pr(g){const o=Et(g,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new qe},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new st(0,0,0,0)},uTroikaClipRect:{value:new st(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new qe},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new $e},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new It},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:ur,vertexTransform:hr,fragmentDefs:cr,fragmentColorTransform:dr,customRewriter({vertexShader:y,fragmentShader:m}){let t=/\buniform\s+vec3\s+diffuse\b/;return t.test(m)&&(m=m.replace(t,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),t.test(y)||(y=y.replace(Pt,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:y,fragmentShader:m}}});return o.transparent=!0,o.forceSinglePass=!0,Object.defineProperties(o,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),o}const at=new wt({color:16777215,side:Rt,transparent:!0}),pt=8421504,vt=new _t,He=new nt,Ze=new nt,Me=[],vr=new nt,et="+x+y";function gt(g){return Array.isArray(g)?g[0]:g}let Tt=()=>{const g=new rt(new ot(1,1),at);return Tt=()=>g,g},Ft=()=>{const g=new rt(new ot(1,1,32,1),at);return Ft=()=>g,g};const gr={type:"syncstart"},yr={type:"synccomplete"},Ct=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],mr=Ct.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class Sr extends rt{constructor(){const o=new fr;super(o,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=pt,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=et,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(o){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(o):(this._isSyncing=!0,this.dispatchEvent(gr),Ut({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},y=>{this._isSyncing=!1,this._textRenderInfo=y,this.geometry.updateGlyphs(y.glyphBounds,y.glyphAtlasIndices,y.blockBounds,y.chunkedBounds,y.glyphColors);const m=this._queuedSyncs;m&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{m.forEach(t=>t&&t())})),this.dispatchEvent(yr),o&&o()})))}onBeforeRender(o,y,m,t,e,n){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(o){return pr(o)}get material(){let o=this._derivedMaterial;const y=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=at.clone());if((!o||!o.isDerivedFrom(y))&&(o=this._derivedMaterial=this.createDerivedMaterial(y),y.addEventListener("dispose",function m(){y.removeEventListener("dispose",m),o.dispose()})),this.hasOutline()){let m=o._outlineMtl;return m||(m=o._outlineMtl=Object.create(o,{id:{value:o.id+.1}}),m.isTextOutlineMaterial=!0,m.depthWrite=!1,m.map=null,o.addEventListener("dispose",function t(){o.removeEventListener("dispose",t),m.dispose()})),[m,o]}else return o}set material(o){o&&o.isTroikaTextMaterial?(this._derivedMaterial=o,this._baseMaterial=o.baseMaterial):this._baseMaterial=o}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(o){this.geometry.detail=o}get curveRadius(){return this.geometry.curveRadius}set curveRadius(o){this.geometry.curveRadius=o}get customDepthMaterial(){return gt(this.material).getDepthMaterial()}set customDepthMaterial(o){}get customDistanceMaterial(){return gt(this.material).getDistanceMaterial()}set customDistanceMaterial(o){}_prepareForRender(o){const y=o.isTextOutlineMaterial,m=o.uniforms,t=this.textRenderInfo;if(t){const{sdfTexture:a,blockBounds:r}=t;m.uTroikaSDFTexture.value=a,m.uTroikaSDFTextureSize.value.set(a.image.width,a.image.height),m.uTroikaSDFGlyphSize.value=t.sdfGlyphSize,m.uTroikaSDFExponent.value=t.sdfExponent,m.uTroikaTotalBounds.value.fromArray(r),m.uTroikaUseGlyphColors.value=!y&&!!t.glyphColors;let i=0,s=0,l=0,f,u,h,d=0,p=0;if(y){let{outlineWidth:S,outlineOffsetX:b,outlineOffsetY:v,outlineBlur:U,outlineOpacity:w}=this;i=this._parsePercent(S)||0,s=Math.max(0,this._parsePercent(U)||0),f=w,d=this._parsePercent(b)||0,p=this._parsePercent(v)||0}else l=Math.max(0,this._parsePercent(this.strokeWidth)||0),l&&(h=this.strokeColor,m.uTroikaStrokeColor.value.set(h??pt),u=this.strokeOpacity,u==null&&(u=1)),f=this.fillOpacity;m.uTroikaEdgeOffset.value=i,m.uTroikaPositionOffset.value.set(d,p),m.uTroikaBlurRadius.value=s,m.uTroikaStrokeWidth.value=l,m.uTroikaStrokeOpacity.value=u,m.uTroikaFillOpacity.value=f??1,m.uTroikaCurveRadius.value=this.curveRadius||0;let _=this.clipRect;if(_&&Array.isArray(_)&&_.length===4)m.uTroikaClipRect.value.fromArray(_);else{const S=(this.fontSize||.1)*100;m.uTroikaClipRect.value.set(r[0]-S,r[1]-S,r[2]+S,r[3]+S)}this.geometry.applyClipRect(m.uTroikaClipRect.value)}m.uTroikaSDFDebug.value=!!this.debugSDF,o.polygonOffset=!!this.depthOffset,o.polygonOffsetFactor=o.polygonOffsetUnits=this.depthOffset||0;const e=y?this.outlineColor||0:this.color;if(e==null)delete o.color;else{const a=o.hasOwnProperty("color")?o.color:o.color=new $e;(e!==a._input||typeof e=="object")&&a.set(a._input=e)}let n=this.orientation||et;if(n!==o._orientation){let a=m.uTroikaOrient.value;n=n.replace(/[^-+xyz]/g,"");let r=n!==et&&n.match(/^([-+])([xyz])([-+])([xyz])$/);if(r){let[,i,s,l,f]=r;He.set(0,0,0)[s]=i==="-"?1:-1,Ze.set(0,0,0)[f]=l==="-"?-1:1,vt.lookAt(vr,He.cross(Ze),Ze),a.setFromMatrix4(vt)}else a.identity();o._orientation=n}}_parsePercent(o){if(typeof o=="string"){let y=o.match(/^(-?[\d.]+)%$/),m=y?parseFloat(y[1]):NaN;o=(isNaN(m)?0:m/100)*this.fontSize}return o}localPositionToTextCoords(o,y=new qe){y.copy(o);const m=this.curveRadius;return m&&(y.x=Math.atan2(o.x,Math.abs(m)-Math.abs(o.z))*Math.abs(m)),y}worldPositionToTextCoords(o,y=new qe){return He.copy(o),this.localPositionToTextCoords(this.worldToLocal(He),y)}raycast(o,y){const{textRenderInfo:m,curveRadius:t}=this;if(m){const e=m.blockBounds,n=t?Ft():Tt(),a=n.geometry,{position:r,uv:i}=a.attributes;for(let s=0;s<i.count;s++){let l=e[0]+i.getX(s)*(e[2]-e[0]);const f=e[1]+i.getY(s)*(e[3]-e[1]);let u=0;t&&(u=t-Math.cos(l/t)*t,l=Math.sin(l/t)*t),r.setXYZ(s,l,f,u)}a.boundingSphere=this.geometry.boundingSphere,a.boundingBox=this.geometry.boundingBox,n.matrixWorld=this.matrixWorld,n.material.side=this.material.side,Me.length=0,n.raycast(o,Me);for(let s=0;s<Me.length;s++)Me[s].object=this,y.push(Me[s])}}copy(o){const y=this.geometry;return super.copy(o),this.geometry=y,mr.forEach(m=>{this[m]=o[m]}),this}clone(){return new this.constructor().copy(this)}}Ct.forEach(g=>{const o="_private_"+g;Object.defineProperty(Sr.prototype,g,{get(){return this[o]},set(y){y!==this[o]&&(this[o]=y,this._needsSync=!0)}})});new yt;new $e;export{Sr as T,Fr as p};
